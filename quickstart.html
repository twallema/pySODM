<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quickstart &mdash; pySODM  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Modeling and Calibration Workflow" href="workflow.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            pySODM
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#set-up-a-dimensionless-ode-model">Set up a dimensionless ODE model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#set-up-an-ode-model-with-a-labeled-dimension">Set up an ODE model with a labeled dimension</a></li>
<li class="toctree-l2"><a class="reference internal" href="#set-up-an-ode-model-with-multiple-dimensions">Set up an ODE model with multiple dimensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#set-up-a-dimensionless-sde-model">Set up a dimensionless SDE Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-simulation-features">Advanced simulation features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#draw-function">Draw function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#time-dependent-parameter-function">Time-dependent parameter function</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="workflow.html">Modeling and calibration workflow</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Case studies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="enzyme_kinetics.html">Enzyme kinetics</a></li>
<li class="toctree-l1"><a class="reference internal" href="influenza_1718.html">Influenza 2017-2018</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">Additional references</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="optimization.html">Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="speedup.html">Speeding up models</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="start_to_collaborate.html">Start to collaborate</a></li>
<li class="toctree-l1"><a class="reference internal" href="guidelines.html">Contribution guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="git_workflow.html">Git workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pySODM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Quickstart</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/quickstart.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="quickstart">
<h1>Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this heading">¶</a></h1>
<section id="set-up-a-dimensionless-ode-model">
<h2>Set up a dimensionless ODE model<a class="headerlink" href="#set-up-a-dimensionless-ode-model" title="Permalink to this heading">¶</a></h2>
<p>Load pySODM’s <a class="reference internal" href="models.html"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">ODEModel</span></code> class</span></a> and define your model. As an example, we’ll set up a simple Susceptible-Infectious-Removed (SIR) disease model, schematically represented as follows,</p>
<img src="./_static/figs/quickstart/quickstart_SIR_flowchart.png" width="500" />
<p>and governed by the following equations,</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{eqnarray}
N &amp;=&amp; S + I + R, \\
\frac{dS}{dt} &amp;=&amp; - \beta S (I/N), \\
\frac{dI}{dt} &amp;=&amp; \beta S (I/N) - (1/\gamma)I, \\
\frac{dR}{dt} &amp;=&amp; (1/\gamma)I.
\end{eqnarray}\end{split}\]</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import the ODEModel class</span>
<span class="kn">from</span> <span class="nn">pySODM.models.base</span> <span class="kn">import</span> <span class="n">ODEModel</span>

<span class="c1"># Define the model equations</span>
<span class="k">class</span> <span class="nc">SIR</span><span class="p">(</span><span class="n">ODEModel</span><span class="p">):</span>

    <span class="n">state_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>
    <span class="n">parameter_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">,</span><span class="s1">&#39;gamma&#39;</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
        
        <span class="c1"># Calculate total population</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">S</span><span class="o">+</span><span class="n">I</span><span class="o">+</span><span class="n">R</span>
        <span class="c1"># Calculate differentials</span>
        <span class="n">dS</span> <span class="o">=</span> <span class="o">-</span><span class="n">beta</span><span class="o">*</span><span class="n">S</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">N</span>
        <span class="n">dI</span> <span class="o">=</span> <span class="n">beta</span><span class="o">*</span><span class="n">S</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">gamma</span><span class="o">*</span><span class="n">I</span>
        <span class="n">dR</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">gamma</span><span class="o">*</span><span class="n">I</span>

        <span class="k">return</span> <span class="n">dS</span><span class="p">,</span> <span class="n">dI</span><span class="p">,</span> <span class="n">dR</span>
</pre></div>
</div>
<p>To initialize the model, provide a dictionary containing the initial values of the model states and a dictionary containing all model parameters. Undefined initial states are automatically filled with zeros.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">SIR</span><span class="p">(</span><span class="n">states</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;beta&#39;</span><span class="p">:</span> <span class="mf">0.35</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span>
</pre></div>
</div>
<p>Simulate the model using the <code class="docutils literal notranslate"><span class="pre">sim()</span></code> method. The solver method and tolerance of <code class="docutils literal notranslate"><span class="pre">scipy.solve_ivp()</span></code>, as well as the timesteps included in the output can be tailored. pySODM supports the use of <code class="docutils literal notranslate"><span class="pre">datetime</span></code> types as timesteps.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Timesteps</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sim</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>

<span class="c1"># Dates</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sim</span><span class="p">([</span><span class="s1">&#39;2022-12-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2023-05-01&#39;</span><span class="p">])</span>

<span class="c1"># Tailor method and tolerance of integrator</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sim</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;RK45&#39;</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="s1">&#39;1e-4&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In some situations, the use of a discrete timestep with a fixed length may be preferred,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use a discrete timestepper with step size 1</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sim</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Is equivalent to (`tau` overwrites `method`!):</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sim</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;RK45&#39;</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="s1">&#39;1e-4&#39;</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Results are sent to an <code class="docutils literal notranslate"><span class="pre">xarray.Dataset</span></code>, for more information on indexing and selecting data using <code class="docutils literal notranslate"><span class="pre">xarray</span></code>, <a class="reference external" href="https://docs.xarray.dev/en/stable/user-guide/indexing.html">see</a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;xarray.Dataset&gt;
Dimensions:<span class="w">  </span><span class="o">(</span>time:<span class="w"> </span><span class="m">122</span><span class="o">)</span>
Coordinates:
<span class="w">  </span>*<span class="w"> </span><span class="nb">time</span><span class="w">     </span><span class="o">(</span><span class="nb">time</span><span class="o">)</span><span class="w"> </span>int64<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">8</span><span class="w"> </span>...<span class="w"> </span><span class="m">114</span><span class="w"> </span><span class="m">115</span><span class="w"> </span><span class="m">116</span><span class="w"> </span><span class="m">117</span><span class="w"> </span><span class="m">118</span><span class="w"> </span><span class="m">119</span><span class="w"> </span><span class="m">120</span><span class="w"> </span><span class="m">121</span>
Data<span class="w"> </span>variables:
<span class="w">    </span>S<span class="w">        </span><span class="o">(</span><span class="nb">time</span><span class="o">)</span><span class="w"> </span>float64<span class="w"> </span>1e+03<span class="w"> </span><span class="m">999</span>.6<span class="w"> </span><span class="m">999</span>.2<span class="w"> </span><span class="m">998</span>.7<span class="w"> </span>...<span class="w"> </span><span class="m">287</span>.2<span class="w"> </span><span class="m">287</span>.2<span class="w"> </span><span class="m">287</span>.2<span class="w"> </span><span class="m">287</span>.2
<span class="w">    </span>I<span class="w">        </span><span class="o">(</span><span class="nb">time</span><span class="o">)</span><span class="w"> </span>float64<span class="w"> </span><span class="m">1</span>.0<span class="w"> </span><span class="m">1</span>.161<span class="w"> </span><span class="m">1</span>.348<span class="w"> </span><span class="m">1</span>.565<span class="w"> </span>...<span class="w"> </span><span class="m">0</span>.1455<span class="w"> </span><span class="m">0</span>.1316<span class="w"> </span><span class="m">0</span>.1192
<span class="w">    </span>R<span class="w">        </span><span class="o">(</span><span class="nb">time</span><span class="o">)</span><span class="w"> </span>float64<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.2157<span class="w"> </span><span class="m">0</span>.4662<span class="w"> </span><span class="m">0</span>.7569<span class="w"> </span>...<span class="w"> </span><span class="m">713</span>.6<span class="w"> </span><span class="m">713</span>.7<span class="w"> </span><span class="m">713</span>.7<span class="w"> </span><span class="m">713</span>.7
</pre></div>
</div>
<p>The simulation above results in the following trajectories for the number of susceptibles, infected and recovered individuals.
<img alt="SIR_time" src="_images/quickstart_SIR.png" /></p>
</section>
<section id="set-up-an-ode-model-with-a-labeled-dimension">
<h2>Set up an ODE model with a labeled dimension<a class="headerlink" href="#set-up-an-ode-model-with-a-labeled-dimension" title="Permalink to this heading">¶</a></h2>
<p>To transform all our SIR model’s states in 1D vectors, referred to as a <em>dimension</em> throughout the documentation, add the <code class="docutils literal notranslate"><span class="pre">dimension_names</span></code> keyword to the model declaration. Here, we add a dimension representing the age groups individuals belong to.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import the ODEModel class</span>
<span class="kn">from</span> <span class="nn">pySODM.models.base</span> <span class="kn">import</span> <span class="n">ODEModel</span>

<span class="c1"># Define the model equations</span>
<span class="k">class</span> <span class="nc">stratified_SIR</span><span class="p">(</span><span class="n">ODEModel</span><span class="p">):</span>
    
    <span class="n">state_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>
    <span class="n">parameter_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma]</span>
    <span class="n">dimension_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;age_groups&#39;</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
        
        <span class="c1"># Calculate total population</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">S</span><span class="o">+</span><span class="n">I</span><span class="o">+</span><span class="n">R</span>
        <span class="c1"># Calculate differentials</span>
        <span class="n">dS</span> <span class="o">=</span> <span class="o">-</span><span class="n">beta</span><span class="o">*</span><span class="n">S</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">N</span>
        <span class="n">dI</span> <span class="o">=</span> <span class="n">beta</span><span class="o">*</span><span class="n">S</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">gamma</span><span class="o">*</span><span class="n">I</span>
        <span class="n">dR</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">gamma</span><span class="o">*</span><span class="n">I</span>

        <span class="k">return</span> <span class="n">dS</span><span class="p">,</span> <span class="n">dI</span><span class="p">,</span> <span class="n">dR</span>
</pre></div>
</div>
<p>When initializing the model, additionally provide a dictionary containing coordinates for every dimension declared previously. In our example, we’ll declare four age groups: 0-5, 5-15, 15-65 and 65-120 year olds. <strong>All</strong> model states are now 1D vectors of shape <code class="docutils literal notranslate"><span class="pre">(4,)</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">stratified_SIR</span><span class="p">(</span><span class="n">states</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">4</span><span class="p">)},</span>
                       <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;beta&#39;</span><span class="p">:</span> <span class="mf">0.35</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>
                       <span class="n">coordinates</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;age_groups&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;0-5&#39;</span><span class="p">,</span><span class="s1">&#39;5-15&#39;</span><span class="p">,</span> <span class="s1">&#39;15-65&#39;</span><span class="p">,</span><span class="s1">&#39;65-120&#39;</span><span class="p">]})</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sim</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>                       
</pre></div>
</div>
<p>The dimension <code class="docutils literal notranslate"><span class="pre">'age_groups'</span></code> with coordinates <code class="docutils literal notranslate"><span class="pre">['0-5','5-15',</span> <span class="pre">'15-65','65-120']</span></code> is automatically added to the model output.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;xarray.Dataset&gt;
Dimensions:<span class="w">     </span><span class="o">(</span>time:<span class="w"> </span><span class="m">122</span>,<span class="w"> </span>age_groups:<span class="w"> </span><span class="m">4</span><span class="o">)</span>
Coordinates:
<span class="w">  </span>*<span class="w"> </span><span class="nb">time</span><span class="w">        </span><span class="o">(</span><span class="nb">time</span><span class="o">)</span><span class="w"> </span>int64<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"> </span>...<span class="w"> </span><span class="m">114</span><span class="w"> </span><span class="m">115</span><span class="w"> </span><span class="m">116</span><span class="w"> </span><span class="m">117</span><span class="w"> </span><span class="m">118</span><span class="w"> </span><span class="m">119</span><span class="w"> </span><span class="m">120</span><span class="w"> </span><span class="m">121</span>
<span class="w">  </span>*<span class="w"> </span>age_groups<span class="w">  </span><span class="o">(</span>age_groups<span class="o">)</span><span class="w"> </span>&lt;U6<span class="w"> </span><span class="s1">&#39;0-5&#39;</span><span class="w"> </span><span class="s1">&#39;5-15&#39;</span><span class="w"> </span><span class="s1">&#39;15-65&#39;</span><span class="w"> </span><span class="s1">&#39;65-120&#39;</span>
Data<span class="w"> </span>variables:
<span class="w">    </span>S<span class="w">           </span><span class="o">(</span>age_groups,<span class="w"> </span><span class="nb">time</span><span class="o">)</span><span class="w"> </span>float64<span class="w"> </span>1e+03<span class="w"> </span><span class="m">999</span>.6<span class="w"> </span><span class="m">999</span>.2<span class="w"> </span>...<span class="w"> </span><span class="m">287</span>.2<span class="w"> </span><span class="m">287</span>.2
<span class="w">    </span>I<span class="w">           </span><span class="o">(</span>age_groups,<span class="w"> </span><span class="nb">time</span><span class="o">)</span><span class="w"> </span>float64<span class="w"> </span><span class="m">1</span>.0<span class="w"> </span><span class="m">1</span>.161<span class="w"> </span><span class="m">1</span>.348<span class="w"> </span>...<span class="w"> </span><span class="m">0</span>.1316<span class="w"> </span><span class="m">0</span>.1192
<span class="w">    </span>R<span class="w">           </span><span class="o">(</span>age_groups,<span class="w"> </span><span class="nb">time</span><span class="o">)</span><span class="w"> </span>float64<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.2157<span class="w"> </span><span class="m">0</span>.4662<span class="w"> </span>...<span class="w"> </span><span class="m">713</span>.7<span class="w"> </span><span class="m">713</span>.7
</pre></div>
</div>
</section>
<section id="set-up-an-ode-model-with-multiple-dimensions">
<h2>Set up an ODE model with multiple dimensions<a class="headerlink" href="#set-up-an-ode-model-with-multiple-dimensions" title="Permalink to this heading">¶</a></h2>
<p>pySODM allows model states to have different coordinates and thus different sizes. As an example (without mathematical details), consider an extension of the SIR model for vector borne disease: the SIR-SI model. In the example, the S, I and R states represent the humans, and we use the <code class="docutils literal notranslate"><span class="pre">state_dimensions</span></code> variable to declare the humans are distributed in four age groups. The S_v and I_v states represent the vectors and infected vectors are able to transmit a disease to the humans. In turn, infected humans can pass the disease back to the vector (see flowchart). Because in some contexts having age groups for our vectors is not relevant (f.i. mosquitos), we thus assign no dimensions to the S_v and I_v states.</p>
<img src="./_static/figs/quickstart/quickstart_SIR_SI_flowchart.png" width="700" />
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ODE_SIR_SI</span><span class="p">(</span><span class="n">ODEModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An age-stratified SIR model for humans, an unstratified SI model for a disease vector (f.i. mosquito)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">state_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;S_v&#39;</span><span class="p">,</span> <span class="s1">&#39;I_v&#39;</span><span class="p">]</span>
    <span class="n">parameter_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">]</span>
    <span class="n">parameter_stratified_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
    <span class="n">dimension_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;age_group&#39;</span><span class="p">]</span>
    <span class="n">state_dimensions</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;age_group&#39;</span><span class="p">],[</span><span class="s1">&#39;age_group&#39;</span><span class="p">],[</span><span class="s1">&#39;age_group&#39;</span><span class="p">],[],[]]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">S_v</span><span class="p">,</span> <span class="n">I_v</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>

        <span class="c1"># Calculate total mosquito population</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">S</span> <span class="o">+</span> <span class="n">I</span> <span class="o">+</span> <span class="n">R</span>
        <span class="n">N_v</span> <span class="o">=</span> <span class="n">S_v</span> <span class="o">+</span> <span class="n">I_v</span>
        <span class="c1"># Calculate human differentials</span>
        <span class="n">dS</span> <span class="o">=</span> <span class="o">-</span><span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">I_v</span><span class="o">/</span><span class="n">N_v</span><span class="p">)</span><span class="o">*</span><span class="n">S</span>
        <span class="n">dI</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">I_v</span><span class="o">/</span><span class="n">N_v</span><span class="p">)</span><span class="o">*</span><span class="n">S</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">gamma</span><span class="o">*</span><span class="n">I</span>
        <span class="n">dR</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">gamma</span><span class="o">*</span><span class="n">I</span>
        <span class="c1"># Calculate mosquito differentials</span>
        <span class="n">dS_v</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">I</span><span class="o">/</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">S_v</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span><span class="o">*</span><span class="n">N_v</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span><span class="o">*</span><span class="n">S_v</span>
        <span class="n">dI_v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">I</span><span class="o">/</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">S_v</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span><span class="o">*</span><span class="n">I_v</span>

        <span class="k">return</span> <span class="n">dS</span><span class="p">,</span> <span class="n">dI</span><span class="p">,</span> <span class="n">dR</span><span class="p">,</span> <span class="n">dS_v</span><span class="p">,</span> <span class="n">dI_v</span>
</pre></div>
</div>
<p>Setting up and simulating the model,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define parameters, initial states and coordinates</span>
<span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">]),</span> <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;beta&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">}</span>
<span class="n">init_states</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">606938</span><span class="p">,</span> <span class="mi">1328733</span><span class="p">,</span> <span class="mi">7352492</span><span class="p">,</span> <span class="mi">2204478</span><span class="p">],</span> <span class="s1">&#39;S_v&#39;</span><span class="p">:</span> <span class="mf">1e6</span><span class="p">,</span> <span class="s1">&#39;I_v&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="n">coordinates</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;age_groups&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;0-5&#39;</span><span class="p">,</span><span class="s1">&#39;5-15&#39;</span><span class="p">,</span> <span class="s1">&#39;15-65&#39;</span><span class="p">,</span><span class="s1">&#39;65-120&#39;</span><span class="p">]}</span>
<span class="c1"># Initialize model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">SIR_SI</span><span class="p">(</span><span class="n">states</span><span class="o">=</span><span class="n">init_states</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="n">coordinates</span><span class="p">)</span>
<span class="c1"># Simulate the model</span>
<span class="n">model</span><span class="o">.</span><span class="n">sim</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
<p>results in the following <code class="docutils literal notranslate"><span class="pre">xarray.Dataset</span></code>. Here it can be seen that the S, I and R state have <code class="docutils literal notranslate"><span class="pre">age_group</span></code> and <code class="docutils literal notranslate"><span class="pre">time</span></code> as dimensions and their shape is thus <code class="docutils literal notranslate"><span class="pre">(4,)</span></code>, while S_v and I_v only have <code class="docutils literal notranslate"><span class="pre">time</span></code> as dimension and their shape is thus <code class="docutils literal notranslate"><span class="pre">(1,)</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;xarray.Dataset&gt;
Dimensions:<span class="w">    </span><span class="o">(</span>age_group:<span class="w"> </span><span class="m">4</span>,<span class="w"> </span>time:<span class="w"> </span><span class="m">121</span><span class="o">)</span>
Coordinates:
<span class="w">  </span>*<span class="w"> </span>age_group<span class="w">  </span><span class="o">(</span>age_groups<span class="o">)</span><span class="w"> </span>&lt;U6<span class="w"> </span><span class="s1">&#39;0-5&#39;</span><span class="w"> </span><span class="s1">&#39;5-15&#39;</span><span class="w"> </span><span class="s1">&#39;15-65&#39;</span><span class="w"> </span><span class="s1">&#39;65-120&#39;</span>
<span class="w">  </span>*<span class="w"> </span><span class="nb">time</span><span class="w">       </span><span class="o">(</span><span class="nb">time</span><span class="o">)</span><span class="w"> </span>int64<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"> </span>...<span class="w"> </span><span class="m">113</span><span class="w"> </span><span class="m">114</span><span class="w"> </span><span class="m">115</span><span class="w"> </span><span class="m">116</span><span class="w"> </span><span class="m">117</span><span class="w"> </span><span class="m">118</span><span class="w"> </span><span class="m">119</span><span class="w"> </span><span class="m">120</span>
Data<span class="w"> </span>variables:
<span class="w">    </span>S<span class="w">          </span><span class="o">(</span>age_group,<span class="w"> </span><span class="nb">time</span><span class="o">)</span><span class="w"> </span>float64<span class="w"> </span><span class="m">6</span>.069e+05<span class="w"> </span><span class="m">6</span>.069e+05<span class="w"> </span>...<span class="w"> </span><span class="m">1</span>.653e+06
<span class="w">    </span>I<span class="w">          </span><span class="o">(</span>age_group,<span class="w"> </span><span class="nb">time</span><span class="o">)</span><span class="w"> </span>float64<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.05178<span class="w"> </span>...<span class="w"> </span><span class="m">1</span>.4e+05<span class="w"> </span><span class="m">1</span>.464e+05
<span class="w">    </span>R<span class="w">          </span><span class="o">(</span>age_group,<span class="w"> </span><span class="nb">time</span><span class="o">)</span><span class="w"> </span>float64<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.00545<span class="w"> </span>...<span class="w"> </span><span class="m">3</span>.76e+05<span class="w"> </span><span class="m">4</span>.047e+05
<span class="w">    </span>S_v<span class="w">        </span><span class="o">(</span><span class="nb">time</span><span class="o">)</span><span class="w"> </span>float64<span class="w"> </span>1e+06<span class="w"> </span>1e+06<span class="w"> </span>1e+06<span class="w"> </span>...<span class="w"> </span><span class="m">8</span>.635e+05<span class="w"> </span><span class="m">8</span>.562e+05
<span class="w">    </span>I_v<span class="w">        </span><span class="o">(</span><span class="nb">time</span><span class="o">)</span><span class="w"> </span>float64<span class="w"> </span><span class="m">2</span>.0<span class="w"> </span><span class="m">1</span>.798<span class="w"> </span><span class="m">1</span>.725<span class="w"> </span>...<span class="w"> </span><span class="m">1</span>.292e+05<span class="w"> </span><span class="m">1</span>.365e+05<span class="w"> </span><span class="m">1</span>.438e+05
</pre></div>
</div>
</section>
<section id="set-up-a-dimensionless-sde-model">
<h2>Set up a dimensionless SDE Model<a class="headerlink" href="#set-up-a-dimensionless-sde-model" title="Permalink to this heading">¶</a></h2>
<p>To stochastically simulate the simple SIR model, the <code class="docutils literal notranslate"><span class="pre">SDEModel</span></code> class is loaded and two functions <code class="docutils literal notranslate"><span class="pre">compute_rates</span></code> and <code class="docutils literal notranslate"><span class="pre">apply_transitionings</span></code> must be defined. For a detailed description of implenting models using Gillespie’s methods, we refer to the <a class="reference external" href="https://arxiv.org/abs/2301.10664">manuscript</a>. The rates dictionary defined in <code class="docutils literal notranslate"><span class="pre">compute_rates</span></code> contains the rates of the possible transitionings in the system. These are contained in a list because a state may have multiple possible transitionings. Further, the transitioning for state <code class="docutils literal notranslate"><span class="pre">I</span></code> is a float and this should be a <code class="docutils literal notranslate"><span class="pre">numpy.float</span></code>. I’m still figuring out if I want to introduce the overhead to check and correct this behavior (likely not).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import the ODEModel class</span>
<span class="kn">from</span> <span class="nn">pySODM.models.base</span> <span class="kn">import</span> <span class="n">SDEModel</span>

<span class="c1"># Define the model equations</span>
<span class="k">class</span> <span class="nc">SIR</span><span class="p">(</span><span class="n">SDEModel</span><span class="p">):</span>

    <span class="n">state_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>
    <span class="n">parameter_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">,</span><span class="s1">&#39;gamma&#39;</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">compute_rates</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
        
        <span class="c1"># Calculate total population</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">S</span><span class="o">+</span><span class="n">I</span><span class="o">+</span><span class="n">R</span>
        <span class="c1"># Compute rates per model state</span>
        <span class="n">rates</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">beta</span><span class="o">*</span><span class="p">(</span><span class="n">I</span><span class="o">/</span><span class="n">N</span><span class="p">)),],</span>
            <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">gamma</span><span class="p">)],</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">rates</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">apply_transitionings</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">transitionings</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>

        <span class="n">S_new</span>  <span class="o">=</span> <span class="n">S</span> <span class="o">-</span> <span class="n">transitionings</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">I_new</span> <span class="o">=</span> <span class="n">I</span> <span class="o">+</span> <span class="n">transitionings</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">transitionings</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
        <span class="n">R_new</span> <span class="o">=</span> <span class="n">R</span> <span class="o">+</span> <span class="n">transitionings</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 

        <span class="k">return</span> <span class="n">S_new</span><span class="p">,</span> <span class="n">I_new</span><span class="p">,</span> <span class="n">R_new</span>
</pre></div>
</div>
</section>
<section id="advanced-simulation-features">
<h2>Advanced simulation features<a class="headerlink" href="#advanced-simulation-features" title="Permalink to this heading">¶</a></h2>
<section id="draw-function">
<h3>Draw function<a class="headerlink" href="#draw-function" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">sim()</span></code> method of <code class="docutils literal notranslate"><span class="pre">ODEModel</span></code> and <code class="docutils literal notranslate"><span class="pre">SDEModel</span></code> can be used to perform <span class="math notranslate nohighlight">\(N\)</span> repeated simulations (keyword <code class="docutils literal notranslate"><span class="pre">N</span></code>). Additionally a <em>draw function</em> can be used to update model parameters during every run. A draw function to randomly draw <code class="docutils literal notranslate"><span class="pre">gamma</span></code> from a uniform simulation before every run is implemented as follows,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">draw_function</span><span class="p">(</span><span class="n">param_dict</span><span class="p">,</span> <span class="n">samples_dict</span><span class="p">):</span>
    <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">param_dict</span>

<span class="n">out</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sim</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">draw_function</span><span class="o">=</span><span class="n">draw_function</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="p">{})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>   
</pre></div>
</div>
<p>An additional dimension <code class="docutils literal notranslate"><span class="pre">'draws'</span></code> has been added to the <code class="docutils literal notranslate"><span class="pre">xarray.Dataset</span></code> to accomodate the results of the repeated simulations.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;xarray.Dataset&gt;
Dimensions:<span class="w">     </span><span class="o">(</span>time:<span class="w"> </span><span class="m">122</span>,<span class="w"> </span>age_groups:<span class="w"> </span><span class="m">4</span>,<span class="w"> </span>draws:<span class="w"> </span><span class="m">10</span><span class="o">)</span>
Coordinates:
<span class="w">  </span>*<span class="w"> </span><span class="nb">time</span><span class="w">        </span><span class="o">(</span><span class="nb">time</span><span class="o">)</span><span class="w"> </span>int64<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"> </span>...<span class="w"> </span><span class="m">114</span><span class="w"> </span><span class="m">115</span><span class="w"> </span><span class="m">116</span><span class="w"> </span><span class="m">117</span><span class="w"> </span><span class="m">118</span><span class="w"> </span><span class="m">119</span><span class="w"> </span><span class="m">120</span><span class="w"> </span><span class="m">121</span>
<span class="w">  </span>*<span class="w"> </span>age_groups<span class="w">  </span><span class="o">(</span>age_groups<span class="o">)</span><span class="w"> </span>&lt;U6<span class="w"> </span><span class="s1">&#39;0-5&#39;</span><span class="w"> </span><span class="s1">&#39;5-15&#39;</span><span class="w"> </span><span class="s1">&#39;15-65&#39;</span><span class="w"> </span><span class="s1">&#39;65-120&#39;</span>
Dimensions<span class="w"> </span>without<span class="w"> </span>coordinates:<span class="w"> </span>draws
Data<span class="w"> </span>variables:
<span class="w">    </span>S<span class="w">           </span><span class="o">(</span>draws,<span class="w"> </span>age_groups,<span class="w"> </span><span class="nb">time</span><span class="o">)</span><span class="w"> </span>float64<span class="w"> </span>1e+03<span class="w"> </span><span class="m">999</span>.6<span class="w"> </span>...<span class="w"> </span><span class="m">316</span>.9<span class="w"> </span><span class="m">316</span>.9
<span class="w">    </span>I<span class="w">           </span><span class="o">(</span>draws,<span class="w"> </span>age_groups,<span class="w"> </span><span class="nb">time</span><span class="o">)</span><span class="w"> </span>float64<span class="w"> </span><span class="m">1</span>.0<span class="w"> </span><span class="m">1</span>.007<span class="w"> </span>...<span class="w"> </span><span class="m">0</span>.1644<span class="w"> </span><span class="m">0</span>.1492
<span class="w">    </span>R<span class="w">           </span><span class="o">(</span>draws,<span class="w"> </span>age_groups,<span class="w"> </span><span class="nb">time</span><span class="o">)</span><span class="w"> </span>float64<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.3439<span class="w"> </span>...<span class="w"> </span><span class="m">684</span>.0<span class="w"> </span><span class="m">684</span>.0
</pre></div>
</div>
</section>
<section id="time-dependent-parameter-function">
<h3>Time-dependent parameter function<a class="headerlink" href="#time-dependent-parameter-function" title="Permalink to this heading">¶</a></h3>
<p>Parameters can also be varied through the course of one simulation using a <em>time-dependent parameter function</em>, which can be an arbitrarily complex function. A generic time-dependent parameter function has the timestep, the dictionary of model states and the value of the varied parameter as its inputs. Additionally, the function can take any number of arguments (including other model parameters).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">vary_my_parameter</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">states</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">an_additional_parameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A function to vary a model parameter during a simulation&quot;&quot;&quot;</span>

    <span class="c1"># Do any computation</span>
    <span class="n">param</span> <span class="o">=</span> <span class="o">...</span>

    <span class="k">return</span> <span class="n">param</span>
</pre></div>
</div>
<p>All we need to do is use the <code class="docutils literal notranslate"><span class="pre">time_dependent_parameters</span></code> keyword to declare the parameter our function should be applied to. Additionally, <code class="docutils literal notranslate"><span class="pre">an_additional_parameter</span></code> should be added to the parameters dictionary.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">SIR</span><span class="p">(</span><span class="n">states</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;beta&#39;</span><span class="p">:</span> <span class="mf">0.35</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;an_additional_parameter&#39;</span><span class="p">:</span> <span class="n">anything_you_want</span><span class="p">},</span>
            <span class="n">time_dependent_parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;beta&#39;</span><span class="p">:</span> <span class="n">vary_my_parameter</span><span class="p">})</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="workflow.html" class="btn btn-neutral float-right" title="Modeling and Calibration Workflow" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Tijs Alleman.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>