

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Optimization &mdash; pySODM  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Speeding up models" href="speedup.html" />
    <link rel="prev" title="Models" href="models.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            pySODM
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow.html">Modeling and calibration workflow</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Case studies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="enzyme_kinetics.html">Enzyme kinetics</a></li>
<li class="toctree-l1"><a class="reference internal" href="influenza_1718.html">Influenza 2017-2018</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">Additional references</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="models.html">Models</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Optimization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#pysodm-optimization-objective-functions">pySODM.optimization.objective_functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#log-posterior-probability">Log posterior probability</a></li>
<li class="toctree-l3"><a class="reference internal" href="#log-likelihood">Log likelihood</a></li>
<li class="toctree-l3"><a class="reference internal" href="#log-prior-probability">Log prior probability</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pysodm-optimization-nelder-mead">pySODM.optimization.nelder_mead</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pysodm-optimization-pso">pySODM.optimization.pso</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pysodm-optimization-mcmc">pySODM.optimization.mcmc</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pysodm-optimization-utils">pySODM.optimization.utils</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="speedup.html">Speeding up models</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="start_to_collaborate.html">Start to collaborate</a></li>
<li class="toctree-l1"><a class="reference internal" href="guidelines.html">Contribution guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="git_workflow.html">Git workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pySODM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Optimization</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/optimization.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="optimization">
<h1>Optimization<a class="headerlink" href="#optimization" title="Link to this heading">¶</a></h1>
<section id="pysodm-optimization-objective-functions">
<h2>pySODM.optimization.objective_functions<a class="headerlink" href="#pysodm-optimization-objective-functions" title="Link to this heading">¶</a></h2>
<section id="log-posterior-probability">
<h3>Log posterior probability<a class="headerlink" href="#log-posterior-probability" title="Link to this heading">¶</a></h3>
<p><strong><em>class</em> log_posterior_probability(model, parameter_names, bounds, data, states, log_likelihood_fnc, log_likelihood_fnc_args, start_sim=None, weights=None, log_prior_prob_fnc=None, log_prior_prob_fnc_args=None, initial_states=None, aggregation_function=None, labels=None)</strong></p>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><strong>model</strong> (object) - An initialized <code class="docutils literal notranslate"><span class="pre">pySODM.models.base.ODE</span></code> or <code class="docutils literal notranslate"><span class="pre">pySODM.models.base.JumpProcess</span></code> model.</p></li>
<li><p><strong>parameter_names</strong> (list) - Names of model parameters (type: str) to calibrate. Model parameters must be of type float (0D), list containing float (1D), or np.ndarray (nD).</p></li>
<li><p><strong>bounds</strong> (list) - Lower and upper bound of calibrated parameters. Provided as a list or tuple containing lower and upper bound: example: <code class="docutils literal notranslate"><span class="pre">bounds</span> <span class="pre">=</span> <span class="pre">[(lb_1,</span> <span class="pre">ub_1),</span> <span class="pre">...,</span> <span class="pre">(lb_n,</span> <span class="pre">ub_n)]</span></code>.</p></li>
<li><p><strong>data</strong> (list) - Contains the datasets (type: pd.Series/pd.DataFrame) the model should be calibrated to. If there is only one dataset use <code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">=</span> <span class="pre">[df,]</span></code>. Dataframe must contain an index named <code class="docutils literal notranslate"><span class="pre">time</span></code> or <code class="docutils literal notranslate"><span class="pre">date</span></code>. Stratified data can be incorporated using a <code class="docutils literal notranslate"><span class="pre">pd.Multiindex</span></code>, whose index levels must have names corresponding to valid model dimensions, and whose indices must be valid dimension coordinates.</p></li>
<li><p><strong>states</strong> (list) - Names of the model states (type: str) the respective datasets should be matched to. Must have the same length as <code class="docutils literal notranslate"><span class="pre">data</span></code>.</p></li>
<li><p><strong>log_likelihood_fnc</strong> (list) - Contains a log likelihood function for every provided dataset. Must have the same length as <code class="docutils literal notranslate"><span class="pre">data</span></code>.</p></li>
<li><p><strong>log_likelihood_fnc_args</strong> (list) - Contains the arguments of the log likelihood functions. If the log likelihood function has no arguments (such as <code class="docutils literal notranslate"><span class="pre">ll_poisson</span></code>), provide an empty list. Must have the same length as <code class="docutils literal notranslate"><span class="pre">data</span></code>.</p></li>
<li><p><strong>start_sim</strong> (int/float or str/datetime) - optional - Can be used to alter the start of the simulation. By default, the start of the simulation is chosen as the earliest time/date found in the datasets.</p></li>
<li><p><strong>weights</strong> (list) - optional - Contains the weights of every dataset in the final log posterior probability. Defaults to one for every dataset.</p></li>
<li><p><strong>log_prior_prob_fnc</strong> (list) - optional - Contains a log prior probability function for every calibrated parameter. Must have the same length as <code class="docutils literal notranslate"><span class="pre">parameter_names</span></code>. If not provided, defaults the log prior probability function to a uniform distribution over <code class="docutils literal notranslate"><span class="pre">bounds</span></code>. The log prior probability functions available in
<code class="docutils literal notranslate"><span class="pre">pySODM.optimization.objective_functions</span></code> are <code class="docutils literal notranslate"><span class="pre">log_prior_uniform</span></code>, <code class="docutils literal notranslate"><span class="pre">log_prior_triangle</span></code>, <code class="docutils literal notranslate"><span class="pre">log_prior_normal</span></code>, <code class="docutils literal notranslate"><span class="pre">log_prior_gamma</span></code>, <code class="docutils literal notranslate"><span class="pre">log_prior_beta</span></code> and <code class="docutils literal notranslate"><span class="pre">log_prior_custom</span></code>.</p></li>
<li><p><strong>log_prior_prob_fnc_args</strong> (list) - optional - Contains the arguments of the prior probability functions, as a dictionary. Must have the same length as <code class="docutils literal notranslate"><span class="pre">parameter_names</span></code>. For example, if <code class="docutils literal notranslate"><span class="pre">log_prior_prob_fnc</span> <span class="pre">=</span> <span class="pre">[log_prior_normal,]</span></code> then <code class="docutils literal notranslate"><span class="pre">log_prior_prob_fnc_args</span> <span class="pre">=</span> <span class="pre">[{'avg':</span> <span class="pre">0,</span> <span class="pre">'stdev':</span> <span class="pre">1},]</span></code> or <code class="docutils literal notranslate"><span class="pre">[{'avg':</span> <span class="pre">0,</span> <span class="pre">'stdev':</span> <span class="pre">1,</span> <span class="pre">'weight':</span> <span class="pre">1},]</span></code>.</p></li>
<li><p><strong>initial_states</strong> (list) - optional - Contains a dictionary of initial states for every dataset.</p></li>
<li><p><strong>aggregation_function</strong> (callable function or list) - optional - A user-defined function to manipulate the model output before matching it to data. The function takes as input an <code class="docutils literal notranslate"><span class="pre">xarray.DataArray</span></code>, resulting from selecting the simulation output at the state we wish to match to the dataset (<code class="docutils literal notranslate"><span class="pre">model_output_xarray_Dataset['state_name']</span></code>), as its input. The output of the function must also be an <code class="docutils literal notranslate"><span class="pre">xarray.DataArray</span></code>. No checks are performed on the input or output of the aggregation function, use at your own risk. Illustrative use case: I have a spatially explicit epidemiological model and I desire to simulate it a fine spatial resolution. However, data is only available on a coarser level. Hence, I use an aggregation function to properly aggregate the spatial levels. I change the coordinates on the spatial dimensions in the model output. Valid inputs for the argument <code class="docutils literal notranslate"><span class="pre">aggregation_function</span></code>are: 1) one callable function –&gt; applied to every dataset. 2) A list containing one callable function –&gt; applied to every dataset. 3) A list containing a callable function for every dataset –&gt; every dataset has its own aggregation function.</p></li>
<li><p><strong>labels</strong> (list) - optional - Contains a custom label for the calibrated parameters. Defaults to the names provided in <code class="docutils literal notranslate"><span class="pre">parameter_names</span></code>.</p></li>
<li><p><strong>simulation_kwargs</strong> (dict) - optional - Optional arguments to be passed to the model’s <a class="reference internal" href="models.html"><span class="std std-doc">sim()</span></a> function when evaluating the posterior probability.</p></li>
</ul>
<p><strong>Methods:</strong></p>
<ul>
<li><p><strong><strong>call</strong>(thetas)</strong></p>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><strong>thetas</strong> (list/np.ndarray) - A flattened list containing the estimated parameter values.</p></li>
</ul>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><strong>lp</strong> (float) - Logarithm of the posterior probability.</p></li>
</ul>
</li>
</ul>
</section>
<section id="log-likelihood">
<h3>Log likelihood<a class="headerlink" href="#log-likelihood" title="Link to this heading">¶</a></h3>
<p><strong><em>function</em> ll_normal(ymodel, ydata, sigma)</strong></p>
<blockquote>
<div><p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><strong>ymodel</strong> (list/np.ndarray) - Mean values of the normal distribution (i.e. “mu” values), as predicted by the model</p></li>
<li><p><strong>ydata</strong> (list/np.ndarray) - Data time series values to be matched with the model predictions.</p></li>
<li><p><strong>sigma</strong> (float/list of floats/np.ndarray) - Standard deviation(s) of the normal distribution around the data ‘ydata’. Two options are possible: 1) One error per model dimension, applied uniformly to all datapoints corresponding to that dimension; OR 2) One error for every datapoint, corresponding to a weighted least-squares regression.</p></li>
</ul>
</div></blockquote>
<blockquote>
<div><p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><strong>ll</strong> (float) - Loglikelihood associated with the comparison of the data points and the model prediction.</p></li>
</ul>
</div></blockquote>
<p><strong><em>function</em> ll_lognormal(ymodel, ydata, sigma)</strong></p>
<blockquote>
<div><p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><strong>ymodel</strong> (list/np.ndarray) - Mean values of the lognormal distribution (i.e. “mu” values), as predicted by the model</p></li>
<li><p><strong>ydata</strong> (list/np.ndarray) - Data time series values to be matched with the model predictions.</p></li>
<li><p><strong>sigma</strong> (float/list of floats/np.ndarray) - Standard deviation(s) of the lognormal distribution around the data ‘ydata’. Two options are possible: 1) One error per model dimension, applied uniformly to all datapoints corresponding to that dimension; OR 2) One error for every datapoint, corresponding to a weighted least-squares regression.</p></li>
</ul>
</div></blockquote>
<blockquote>
<div><p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><strong>ll</strong> (float) - Loglikelihood associated with the comparison of the data points and the model prediction.</p></li>
</ul>
</div></blockquote>
<blockquote>
<div><p><strong><em>function</em> ll_poisson(ymodel, ydata)</strong></p>
</div></blockquote>
<blockquote>
<div><p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><strong>ymodel</strong> (list/np.ndarray) - Mean values of the Poisson distribution (i.e. “lambda” values), as predicted by the model.</p></li>
<li><p><strong>ydata</strong> (list/np.ndarray) - Data time series values to be matched with the model predictions.</p></li>
</ul>
</div></blockquote>
<blockquote>
<div><p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><strong>ll</strong> (float) - Loglikelihood associated with the comparison of the data points and the model prediction.</p></li>
</ul>
</div></blockquote>
<p><strong><em>function</em> ll_negative_binomial(ymodel, ydata, alpha)</strong></p>
<blockquote>
<div><p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><strong>ymodel</strong> (list/np.ndarray) - Mean values of the Negative Binomial distribution, as predicted by the model.</p></li>
<li><p><strong>ydata</strong> (list/np.ndarray) - Data time series values to be matched with the model predictions.</p></li>
<li><p><strong>alpha</strong> (float/list) - Dispersion. Must be positive. If alpha goes to zero, the negative binomial distribution converges to the poisson distribution.</p></li>
</ul>
</div></blockquote>
<blockquote>
<div><p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><strong>ll</strong> (float) - Loglikelihood associated with the comparison of the data points and the model prediction.</p></li>
</ul>
</div></blockquote>
</section>
<section id="log-prior-probability">
<h3>Log prior probability<a class="headerlink" href="#log-prior-probability" title="Link to this heading">¶</a></h3>
<p><strong><em>function</em> log_prior_uniform(x, bounds=None, weight=1)</strong></p>
<blockquote>
<div><p>Uniform log prior distribution.</p>
</div></blockquote>
<blockquote>
<div><p><strong>Parameters:</strong></p>
</div></blockquote>
<blockquote>
<div><ul class="simple">
<li><p><strong>x</strong> (float) - Parameter value. Passed internally by pySODM.</p></li>
<li><p><strong>bounds</strong> (tuple) - Tuple containing the lower and upper bounds of the uniform probability distribution.</p></li>
<li><p><strong>weight</strong> (float) - optional - Regularisation weight (default: 1) – does nothing.</p></li>
</ul>
</div></blockquote>
<blockquote>
<div><p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><strong>lp</strong> (float) Log probability of x in light of a uniform prior distribution.</p></li>
</ul>
</div></blockquote>
<p><strong><em>function</em> log_prior_triangle(x, low=None, high=None, mode=None, weight=1)</strong></p>
<blockquote>
<div><p>Triangular log prior distribution.</p>
</div></blockquote>
<blockquote>
<div><p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><strong>x</strong> (float) - Parameter value. Passed internally by pySODM.</p></li>
<li><p><strong>low</strong> (float) - Lower bound of the triangle distribution.</p></li>
<li><p><strong>high</strong> (float) - Upper bound of the triangle distribution.</p></li>
<li><p><strong>mode</strong> (float) - Mode of the triangle distribution.</p></li>
<li><p><strong>weight</strong> (float) - optional - Regularisation weight (default: 1).</p></li>
</ul>
</div></blockquote>
<blockquote>
<div><p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><strong>lp</strong> (float) Log probability of sample x in light of a triangular prior distribution.</p></li>
</ul>
</div></blockquote>
<p><strong><em>function</em> log_prior_normal(x, avg=None, stdev=None, weight=1)</strong></p>
<blockquote>
<div><p>Normal log prior distribution.</p>
</div></blockquote>
<blockquote>
<div><p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><strong>x</strong> (float) - Parameter value. Passed internally by pySODM.</p></li>
<li><p><strong>avg</strong> (float) - Average of the normal distribution.</p></li>
<li><p><strong>stdev</strong> (float) - Standard deviation of the normal distribution.</p></li>
<li><p><strong>weight</strong> (float) - optional - Regularisation weight (default: 1).</p></li>
</ul>
</div></blockquote>
<blockquote>
<div><p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><strong>lp</strong> (float) Log probability of sample x in light of a normal prior distribution.</p></li>
</ul>
</div></blockquote>
<p><strong><em>function</em> log_prior_gamma(x, a=None, loc=None, scale=None, weight=1)</strong></p>
<blockquote>
<div><p>Gamma log prior distribution.</p>
</div></blockquote>
<blockquote>
<div><p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><strong>x</strong> (float) - Parameter value. Passed internally by pySODM.</p></li>
<li><p><strong>a</strong> (float) - Parameter ‘a’ of <code class="docutils literal notranslate"><span class="pre">scipy.stats.gamma.logpdf</span></code>.</p></li>
<li><p><strong>loc</strong> (float) - Location parameter of <code class="docutils literal notranslate"><span class="pre">scipy.stats.gamma.logpdf</span></code>.</p></li>
<li><p><strong>scale</strong> (float) - Scale parameter of <code class="docutils literal notranslate"><span class="pre">scipy.stats.gamma.logpdf</span></code>.</p></li>
<li><p><strong>weight</strong> (float) - optional - Regularisation weight (default: 1).</p></li>
</ul>
</div></blockquote>
<blockquote>
<div><p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><strong>lp</strong> (float) Log probability of sample x in light of a gamma prior distribution.</p></li>
</ul>
</div></blockquote>
<p><strong><em>function</em> log_prior_beta(x, a=None, b=None, loc=None, scale=None, weight=1)</strong></p>
<blockquote>
<div><p>Beta log prior distribution.</p>
</div></blockquote>
<blockquote>
<div><p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><strong>x</strong> (float) - Parameter value. Passed internally by pySODM.</p></li>
<li><p><strong>a</strong> (float) - Parameter ‘a’ of <code class="docutils literal notranslate"><span class="pre">scipy.stats.beta.logpdf</span></code>.</p></li>
<li><p><strong>b</strong> (float) - Parameter ‘b’ of <code class="docutils literal notranslate"><span class="pre">scipy.stats.beta.logpdf</span></code>.</p></li>
<li><p><strong>loc</strong> (float) - Location parameter of <code class="docutils literal notranslate"><span class="pre">scipy.stats.beta.logpdf</span></code>.</p></li>
<li><p><strong>scale</strong> (float) - Scale parameter of <code class="docutils literal notranslate"><span class="pre">scipy.stats.beta.logpdf</span></code>.</p></li>
<li><p><strong>weight</strong> (float) - optional - Regularisation weight (default: 1).</p></li>
</ul>
</div></blockquote>
<blockquote>
<div><p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><strong>lp</strong> (float) Log probability of sample x in light of a beta prior distribution.</p></li>
</ul>
</div></blockquote>
<p><strong><em>function</em> log_prior_custom(x, density=None, bins=None, weight=1)</strong></p>
<blockquote>
<div><p>A custom log prior distribution: compute the probability of a sample in light of a list containing samples from a distribution</p>
</div></blockquote>
<blockquote>
<div><p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><strong>x</strong> (float) - Parameter value. Passed internally by pySODM.</p></li>
<li><p><strong>density</strong> (np.ndarray) - The values of the histogram (generated by <code class="docutils literal notranslate"><span class="pre">np.histogram()</span></code>).</p></li>
<li><p><strong>bins</strong> (np.ndarray) - The histogram’s bin edges (generated by <code class="docutils literal notranslate"><span class="pre">np.histogram()</span></code>).</p></li>
<li><p><strong>weight</strong> (float) - optional - Regularisation weight (default: 1).</p></li>
</ul>
</div></blockquote>
<blockquote>
<div><p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><strong>lp</strong> (float) Log probability of x in light of a custom distribution of data.</p></li>
</ul>
</div></blockquote>
<blockquote>
<div><p><strong>Example use:</strong></p>
</div></blockquote>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">density_my_par</span><span class="p">,</span> <span class="n">bins_my_par</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">([</span><span class="n">sample_0</span><span class="p">,</span> <span class="n">sample_1</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">sample_n</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># convert to a list of samples to a binned PDF</span>
<span class="n">prior_fcn</span> <span class="o">=</span> <span class="n">prior_custom</span>
<span class="n">prior_fcn_args</span> <span class="o">=</span> <span class="p">(</span><span class="n">density_my_par_norm</span><span class="p">,</span> <span class="n">bins_my_par</span><span class="p">,</span> <span class="n">weight</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="pysodm-optimization-nelder-mead">
<h2>pySODM.optimization.nelder_mead<a class="headerlink" href="#pysodm-optimization-nelder-mead" title="Link to this heading">¶</a></h2>
<p><strong><em>function</em> optimize(func, x_start, step, bounds=None, args=(), kwargs={}, processes=1, no_improve_thr=1e-6, no_improv_break=100, max_iter=1000, alpha=1., gamma=2., rho=-0.5, sigma=0.5)</strong></p>
<blockquote>
<div><p>Perform a <a class="reference external" href="https://en.wikipedia.org/wiki/Nelder%E2%80%93Mead_method">Nelder-Mead minimization</a>.</p>
</div></blockquote>
<blockquote>
<div><p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><strong>func</strong> (function) - Callable function or class representing the objective function to be minimized. Recommended using <code class="docutils literal notranslate"><span class="pre">pySODM.optimization.log_posterior_probability</span></code>.</p></li>
<li><p><strong>x_start</strong> (list or 1D np.ndarray) - Starting estimate for the search algorithm. Length must equal the number of provided bounds.</p></li>
<li><p><strong>step</strong> (list or 1D np.ndarray) - (Relative) size of the initial search simplex.</p></li>
<li><p><strong>bounds</strong> (list) - optional - The bounds of the design variable(s). In form <code class="docutils literal notranslate"><span class="pre">[(lb_1,</span> <span class="pre">ub_1),</span> <span class="pre">...,</span> <span class="pre">(lb_n,</span> <span class="pre">ub_n)]</span></code>. If class <code class="docutils literal notranslate"><span class="pre">log_posterior_probability</span></code> is used as <code class="docutils literal notranslate"><span class="pre">func</span></code>, it already contains bounds. If bounds are provided these will overwrite the bounds available in the ‘log_posterior_probability’ object.</p></li>
<li><p><strong>args</strong> (tuple) - optional - Additional arguments passed to objective function.</p></li>
<li><p><strong>kwargs</strong> (dict) - optional - Additional keyworded arguments passed to objective function.</p></li>
<li><p><strong>processes</strong> (int) - optional - Number of cores to use.</p></li>
</ul>
</div></blockquote>
<blockquote>
<div><p><strong>Hyperparameters:</strong></p>
<ul class="simple">
<li><p><strong>no_improve_thr</strong> (float) - optional - Threshold relative iteration-to-iteration objective function value change to label the iteration as having no improvement.</p></li>
<li><p><strong>no_improv_break</strong> (int) - optional - Break after <code class="docutils literal notranslate"><span class="pre">no_improv_break</span></code> iterations without improvement.</p></li>
<li><p><strong>max_iter</strong> (int) - optional - Maximum number of iterations.</p></li>
<li><p><strong>alpha</strong> (float) - optional - Reflection coefficient</p></li>
<li><p><strong>gamma</strong> (float) - optional - Expansion coefficient</p></li>
<li><p><strong>rho</strong> (float) - optional - Contraction coefficient</p></li>
<li><p><strong>sigma</strong> (float) - optional - Shrink coefficient</p></li>
</ul>
</div></blockquote>
<blockquote>
<div><p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><strong>theta</strong> (list) - Optimised parameter values.</p></li>
<li><p><strong>score</strong> (float) - Corresponding corresponding objective function value.</p></li>
</ul>
</div></blockquote>
</section>
<section id="pysodm-optimization-pso">
<h2>pySODM.optimization.pso<a class="headerlink" href="#pysodm-optimization-pso" title="Link to this heading">¶</a></h2>
<p><strong><em>function</em> optimize(func, bounds=None, ieqcons=[], f_ieqcons=None, args=(), kwargs={}, processes=1, swarmsize=100, max_iter=100, minstep=1e-12, minfunc=1e-12, omega=0.8, phip=0.8, phig=0.8,  debug=False, particle_output=False, transform_pars=None)</strong></p>
<blockquote>
<div><p>Perform a <a class="reference external" href="https://en.wikipedia.org/wiki/Particle_swarm_optimization">Particle Swarm Optimization</a>.</p>
</div></blockquote>
<blockquote>
<div><p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><strong>func</strong> (function) - Callable function or class representing the objective function to be minimized. Recommended using <code class="docutils literal notranslate"><span class="pre">log_posterior_probability</span></code>.</p></li>
<li><p><strong>bounds</strong> (list) - optional - The bounds of the design variable(s). In form <code class="docutils literal notranslate"><span class="pre">[(lb_1,</span> <span class="pre">ub_1),</span> <span class="pre">...,</span> <span class="pre">(lb_n,</span> <span class="pre">ub_n)]</span></code>. If class <code class="docutils literal notranslate"><span class="pre">log_posterior_probability</span></code> is used as <code class="docutils literal notranslate"><span class="pre">func</span></code>, it already contains bounds. If bounds are provided these will overwrite the bounds available in the ‘log_posterior_probability’ object.</p></li>
<li><p><strong>args</strong> (tuple) - optional - Additional arguments passed to objective function.</p></li>
<li><p><strong>kwargs</strong> (dict) - optional - Additional keyworded arguments passed to objective function.</p></li>
<li><p><strong>ieqcons</strong> (list) - A list of functions of length n such that <code class="docutils literal notranslate"><span class="pre">ieqcons[j](x,*args)</span> <span class="pre">&gt;=</span> <span class="pre">0.0</span></code> in a successfully optimized problem</p></li>
<li><p><strong>f_ieqcons</strong> (function) - Returns a 1-D array in which each element must be greater or equal to 0.0 in a successfully optimized problem. If f_ieqcons is specified, ieqcons is ignored</p></li>
<li><p><strong>processes</strong> (int) - optional - Number of cores to use.</p></li>
</ul>
</div></blockquote>
<blockquote>
<div><p><strong>Hyperparameters:</strong></p>
<ul class="simple">
<li><p><strong>swarmsize</strong> (int) - optional - Size of the swarm. “Number of particles”</p></li>
<li><p><strong>max_iter</strong> (int) - optional - Maximum number of iterations</p></li>
<li><p><strong>minstep</strong> (float) - optional - The minimum stepsize of swarm’s best position before the search terminates</p></li>
<li><p><strong>minfunc</strong> (float) - optional - The minimum change of swarm’s best objective value before the search terminates</p></li>
<li><p><strong>omega</strong> (float) - optional - Inertia weight. Must be smaller than one.</p></li>
<li><p><strong>phip</strong> (float) - optional - Tendency to search away from the particles best known position.  A higher value means each particle has less confidence in it’s own best value.</p></li>
<li><p><strong>phig</strong> (float) - optional - Tendency to search away from the swarm’s best known position. A higher value means each particle has less confidence in the swarm’s best value.</p></li>
<li><p><strong>debug</strong> (bool) - optional - If True, progress statements will be displayed every iteration</p></li>
<li><p><strong>transform_pars</strong> (func) - optional - Transform the parameter values. E.g. to integer values or to map to a list of possibilities</p></li>
</ul>
</div></blockquote>
<blockquote>
<div><p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><strong>theta</strong> (list) - Optimised parameter values.</p></li>
<li><p><strong>score</strong> (float) - Corresponding corresponding objective function value.</p></li>
</ul>
</div></blockquote>
</section>
<section id="pysodm-optimization-mcmc">
<h2>pySODM.optimization.mcmc<a class="headerlink" href="#pysodm-optimization-mcmc" title="Link to this heading">¶</a></h2>
<p><strong><em>function</em> run_EnsembleSampler(pos, max_n, identifier, objective_function, objective_function_args=None, objective_function_kwargs=None, moves=[(emcee.moves.DEMove(), 0.25),(emcee.moves.DESnookerMove(),0.25),(emcee.moves.KDEMove(bw_method=’scott’), 0.50)], fig_path=None, samples_path=None, print_n=10, backend=None, processes=1, progress=True, settings_dict={})</strong></p>
<blockquote>
<div><p>Wrapper function to setup an <code class="docutils literal notranslate"><span class="pre">emcee.EnsembleSampler</span></code> and handle all backend-related tasks.</p>
</div></blockquote>
<blockquote>
<div><p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><strong>pos</strong> (np.ndarray) - Starting position of the Markov Chains. We recommend using <code class="docutils literal notranslate"><span class="pre">perturbate_theta()</span></code>.</p></li>
<li><p><strong>max_n</strong> (int) - Maximum number of iterations.</p></li>
<li><p><strong>identifier</strong> (str) - Identifier of the expirement.</p></li>
<li><p><strong>objective_function</strong> (callable function) - Objective function. Recommended <code class="docutils literal notranslate"><span class="pre">log_posterior_probability</span></code>.</p></li>
<li><p><strong>objective_function_args</strong> (tuple) - optional - Arguments of the objective function. If using <code class="docutils literal notranslate"><span class="pre">log_posterior_probability</span></code> as objective function, use default <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><strong>objective_function_kwargs</strong> (dict) - optional - Keyworded arguments of the objective function. If using <code class="docutils literal notranslate"><span class="pre">log_posterior_probability</span></code> as objective function, use default <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><strong>fig_path</strong> (str) - optional - Location where the diagnostic figures (autocorrelation and trace plot) are saved.</p></li>
<li><p><strong>samples_path</strong> (str) - optional - Location where the <code class="docutils literal notranslate"><span class="pre">.hdf5</span></code> backend and settings <code class="docutils literal notranslate"><span class="pre">.json</span></code> should be saved.</p></li>
<li><p><strong>print_n</strong> (int) - optional - Print autocorrelation and trace plots every <code class="docutils literal notranslate"><span class="pre">print_n</span></code> iterations.</p></li>
<li><p><strong>discard</strong> (int) - optional - Number of iterations to remove from the beginning of the markov chains (“burn-in”).</p></li>
<li><p><strong>thin</strong> (int) - optional - Retain only every <code class="docutils literal notranslate"><span class="pre">thin</span></code>-th iteration.</p></li>
<li><p><strong>processes</strong> (int) - optional - Number of cores to use.</p></li>
<li><p><strong>settings_dict</strong> (dict) - optional - Dictionary containing calibration settings or other usefull settings for long-term storage. Appended to output <code class="docutils literal notranslate"><span class="pre">samples_xr</span></code> as attributes. Valid datatypes for values: str, Number, ndarray, number, list, tuple, bytes.</p></li>
</ul>
</div></blockquote>
<blockquote>
<div><p><strong>Hyperparameters:</strong></p>
<ul class="simple">
<li><p><strong>moves</strong> (list) - optional - Algorithm used for updating the coordinates of walkers in an ensemble sampler. By default, pySODM uses a shotgun approach by implementing a balanced cocktail of <code class="docutils literal notranslate"><span class="pre">emcee</span></code> moves. Consult the <a class="reference external" href="https://emcee.readthedocs.io/en/stable/user/moves/">emcee documentation</a> for an overview of all moves.</p></li>
<li><p><strong>backend</strong> (str) - optional - Path to backend of a previous sampling run. If a backend is provided, the sampler is restarted from the last iteration of the previous run. Consult the <a class="reference external" href="https://emcee.readthedocs.io/en/stable/user/backends/">emcee documentation</a>.</p></li>
<li><p><strong>progress</strong> (bool) - optional - Enables the progress bar.</p></li>
</ul>
</div></blockquote>
<blockquote>
<div><p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><strong>sampler</strong> (<code class="docutils literal notranslate"><span class="pre">emcee.EnsembleSampler</span></code>) - Emcee sampler object (<a class="reference external" href="https://emcee.readthedocs.io/en/stable/user/sampler/">see</a>).</p></li>
<li><p><strong>samples_xr</strong> (<code class="docutils literal notranslate"><span class="pre">xarray.Dataset</span></code>) - Samples formatted in an xarray.Dataset.</p>
<ul>
<li><p>scalar parameters:</p>
<ul>
<li><p>dimensions: <code class="docutils literal notranslate"><span class="pre">['iteration',</span> <span class="pre">'chain']</span></code></p></li>
<li><p>coordinates: <code class="docutils literal notranslate"><span class="pre">[samples_np.shape[0],</span> <span class="pre">samples_np.shape[1]]</span></code></p></li>
</ul>
</li>
<li><p>n-dimensional parameters:</p>
<ul>
<li><p>dimensions: <code class="docutils literal notranslate"><span class="pre">['iteration',</span> <span class="pre">'chain',</span> <span class="pre">'{parname}_dim_0',</span> <span class="pre">...,</span> <span class="pre">'{parname}_dim_n']</span></code></p></li>
<li><p>coordinates: <code class="docutils literal notranslate"><span class="pre">[samples_np.shape[0],</span> <span class="pre">samples_np.shape[1],</span> <span class="pre">parameter_shapes[parname][0],</span> <span class="pre">...,</span> <span class="pre">parameter_shapes[parname][n]]</span></code></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div></blockquote>
<p><strong><em>function</em> perturbate_theta(theta, pert, multiplier=2, bounds=None, verbose=None)</strong></p>
<blockquote>
<div><p>A function to perturbate a NM/PSO estimate and construct a matrix with initial positions for the MCMC chains</p>
</div></blockquote>
<blockquote>
<div><p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><strong>theta</strong> (list or 1D np.ndarray) - List containing the parameter values to be perturbated.</p></li>
<li><p><strong>pert</strong> (list) - Relative perturbation per parameter in <code class="docutils literal notranslate"><span class="pre">theta</span></code>. Drawn from a uniform distribution (plus-minus pert).</p></li>
<li><p><strong>multiplier</strong> (int) - optional - Multiplier determining the total number of markov chains that will be run by <code class="docutils literal notranslate"><span class="pre">emcee</span></code>. Typically, total nr. chains = multiplier * nr. parameters. Minimum is two, at least five recommended.</p></li>
<li><p><strong>bounds</strong> (list) - optional - Lower and upper bound of calibrated parameters provided as tuples. <code class="docutils literal notranslate"><span class="pre">[(lb_1,</span> <span class="pre">ub_1),</span> <span class="pre">...,</span> <span class="pre">(lb_n,</span> <span class="pre">ub_n)]</span></code>. Note: bounds must not be zero, because the perturbation is based on a percentage of the value, and any percentage of zero returns zero, causing an error regarding linear dependence of walkers.</p></li>
<li><p><strong>verbose</strong> (bool) - optional - Print user feedback to stdout</p></li>
</ul>
</div></blockquote>
<blockquote>
<div><p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><strong>ndim</strong> (int) - Number of parameters. Equal to <code class="docutils literal notranslate"><span class="pre">len(theta)</span></code>.</p></li>
<li><p><strong>nwalkers</strong> (int) - Number of Markov chains.</p></li>
<li><p><strong>pos</strong> (np.ndarray) - Initial positions of the Markov chains. Dimensions: <code class="docutils literal notranslate"><span class="pre">[ndim,</span> <span class="pre">nwalkers]</span></code>.</p></li>
</ul>
</div></blockquote>
</section>
<section id="pysodm-optimization-utils">
<h2>pySODM.optimization.utils<a class="headerlink" href="#pysodm-optimization-utils" title="Link to this heading">¶</a></h2>
<p><strong><em>function</em> add_poisson_noise(output)</strong></p>
<blockquote>
<div><p>Replace every value x in a simulation output with a realization from a Poisson distribution with expectation value x</p>
</div></blockquote>
<blockquote>
<div><p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><strong>output</strong> (xarray.Dataset) - Simulation output (obtained using the <code class="docutils literal notranslate"><span class="pre">sim()</span></code> function of <code class="docutils literal notranslate"><span class="pre">ODE</span></code> or <code class="docutils literal notranslate"><span class="pre">JumpProcess</span></code>).</p></li>
</ul>
</div></blockquote>
<blockquote>
<div><p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><strong>output</strong> (xarray.Dataset) - Simulation output</p></li>
</ul>
</div></blockquote>
<p><strong><em>function</em> add_gaussian_noise(output, sigma, relative=True)</strong></p>
<blockquote>
<div><p>Replace every value x in a simulation output with a realization from a normal distribution with average x and standard deviation <code class="docutils literal notranslate"><span class="pre">sigma</span></code> (relative=False) or x*<code class="docutils literal notranslate"><span class="pre">sigma</span></code> (relative=True)</p>
</div></blockquote>
<blockquote>
<div><p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><strong>output</strong> (xarray.Dataset) - Simulation output (obtained using the <code class="docutils literal notranslate"><span class="pre">sim()</span></code> function of <code class="docutils literal notranslate"><span class="pre">ODE</span></code> or <code class="docutils literal notranslate"><span class="pre">JumpProcess</span></code>).</p></li>
<li><p><strong>sigma</strong> (float) - Standard deviation. Must be larger than or equal to 0.</p></li>
<li><p><strong>relative</strong> (bool) - Add noise relative to magnitude of simulation output.</p></li>
</ul>
</div></blockquote>
<blockquote>
<div><p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><strong>output</strong> (xarray.Dataset) - Simulation output</p></li>
</ul>
</div></blockquote>
<p><strong><em>function</em> add_negative_binomial_noise(output, alpha)</strong></p>
<blockquote>
<div><p>Replace every value x in a simulation output with a realization from a negative binomial distribution with expectation value x and overdispersion <code class="docutils literal notranslate"><span class="pre">alpha</span></code></p>
</div></blockquote>
<blockquote>
<div><p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><strong>output</strong> (xarray.Dataset) - Simulation output (obtained using the <code class="docutils literal notranslate"><span class="pre">sim()</span></code> function of <code class="docutils literal notranslate"><span class="pre">ODE</span></code> or <code class="docutils literal notranslate"><span class="pre">JumpProcess</span></code>).</p></li>
<li><p><strong>alpha</strong> (float) - Overdispersion factor. Must be larger than or equal to 0. Reduces to Poisson noise for alpha –&gt; 0.</p></li>
</ul>
</div></blockquote>
<blockquote>
<div><p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><strong>output</strong> (xarray.Dataset) - Simulation output</p></li>
</ul>
</div></blockquote>
<p><strong><em>function</em> assign_theta(param_dict, parameter_names, thetas)</strong></p>
<blockquote>
<div><p>A function to assign a vector containing estimates of model parameters to the model parameters dictionary</p>
</div></blockquote>
<blockquote>
<div><p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><strong>param_dict</strong> (dict) - Model parameters dictionary</p></li>
<li><p><strong>parameter_names</strong> (list) - Names of model parameters estimated using PSO</p></li>
<li><p><strong>thetas</strong> (list or 1D np.ndarray) - A list with values of model parameters. Values ordermust correspond to the order of <code class="docutils literal notranslate"><span class="pre">parameter_names</span></code></p></li>
</ul>
</div></blockquote>
<blockquote>
<div><p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><strong>param_dict</strong> (dict) - Model parameters dictionary with values of parameters <code class="docutils literal notranslate"><span class="pre">parameter_names</span></code> set to the values listed in <code class="docutils literal notranslate"><span class="pre">thetas</span></code></p></li>
</ul>
</div></blockquote>
<p><strong><em>function</em> variance_analysis(data, resample_frequency)</strong></p>
<blockquote>
<div><p>A function to analyze the relationship between the variance and the mean in a timeseries of data, usefull when no measure of error is available.</p>
</div></blockquote>
<blockquote>
<div><p>The timeseries is binned into sets of length <code class="docutils literal notranslate"><span class="pre">resample_frequency</span></code>. The mean and variance of the datapoints within each bin are estimated. Several statistical models are then fitted to the relationship between the mean and variance. The statistical models are: Gaussian (<span class="math notranslate nohighlight">\(\sigma^2 = c\)</span>), Poisson (<span class="math notranslate nohighlight">\(\sigma^2 = \mu\)</span>), Quasi-poisson (<span class="math notranslate nohighlight">\(\sigma^2 = \alpha \mu\)</span>), Negative Binomial (<span class="math notranslate nohighlight">\(\sigma^2 = \mu + \alpha \mu^2\)</span>)</p>
</div></blockquote>
<blockquote>
<div><p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><strong>data</strong> (pd.Series or pd.DataFrame) - Timeseries of data to be analyzed. The series must have a pd.Timestamp index labeled ‘date’ for the time dimension. Additionally, this function supports the addition of one more dimension (f.i. space) using a pd.Multiindex.</p></li>
<li><p><strong>resample_frequency</strong> (str) - The resample frequency determines the number of days in each bin. We recommend varying this parameter before drawing conclusions. Valid options are: ‘W’: weekly, ‘2W’: biweekly, ‘M’: monthly, etc. <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#offset-aliases">Consult the pandas docs</a>.</p></li>
</ul>
</div></blockquote>
<blockquote>
<div><p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><strong>result</strong> (pd.Dataframe) - Contains the estimated parameter(s) and the Akaike Information Criterion (AIC) of the fitted statistical model. If two index levels are present (thus ‘date’ and ‘other index level’), the result pd.Dataframe contains the result stratified per ‘other index level’.</p></li>
<li><p><strong>ax</strong> (matplotlib.pyplot axis object) - Contains a plot of the estimated mean versus variance, togheter with the fitted statistical models. The best-fitting model is highlighted.</p></li>
</ul>
</div></blockquote>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="models.html" class="btn btn-neutral float-left" title="Models" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="speedup.html" class="btn btn-neutral float-right" title="Speeding up models" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Tijs Alleman.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>