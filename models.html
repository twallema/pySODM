<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Models &mdash; pySODM  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Optimization" href="optimization.html" />
    <link rel="prev" title="Additional references" href="references.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            pySODM
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow.html">Modeling and calibration workflow</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Case studies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="enzyme_kinetics.html">Enzyme kinetics</a></li>
<li class="toctree-l1"><a class="reference internal" href="influenza_1718.html">Influenza 2017-2018</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">Additional references</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User guide</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#base-py">base.py</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#class-ode"><em>class</em> ODE</a></li>
<li class="toctree-l3"><a class="reference internal" href="#class-jumpprocess"><em>class</em> JumpProcess</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="optimization.html">Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="speedup.html">Speeding up models</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="start_to_collaborate.html">Start to collaborate</a></li>
<li class="toctree-l1"><a class="reference internal" href="guidelines.html">Contribution guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="git_workflow.html">Git workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pySODM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Models</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/models.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="models">
<h1>Models<a class="headerlink" href="#models" title="Link to this heading">¶</a></h1>
<p>pySODM contains a class to build ordinary differential equation models (<code class="docutils literal notranslate"><span class="pre">ODE</span></code>) and a class to build stochastic jump process models (<code class="docutils literal notranslate"><span class="pre">JumpProcess</span></code>), both live in <code class="docutils literal notranslate"><span class="pre">models/base.py</span></code>. To learn more about initialising and simulating these models, see the <a class="reference internal" href="quickstart.html"><span class="std std-doc">quickstart tutorial</span></a>.</p>
<section id="base-py">
<h2>base.py<a class="headerlink" href="#base-py" title="Link to this heading">¶</a></h2>
<section id="class-ode">
<h3><em>class</em> ODE<a class="headerlink" href="#class-ode" title="Link to this heading">¶</a></h3>
<p><strong>Inherits from the user’s model class:</strong></p>
<ul class="simple">
<li><p><strong>states</strong> (list) - Names of the model’s states.</p></li>
<li><p><strong>parameters</strong> (list) - Names of the model’s parameters. Parameters are not subject to input checks and can have any type.</p></li>
<li><p><strong>integrate</strong> (function) - Function computing the differentials of every model state. The integrate function must have the timestep <code class="docutils literal notranslate"><span class="pre">t</span></code> as its first input, followed by the names of the model’s states, parameters and stratified parameters (order not important). The integrate function must return a differential for every model state of the correct shape and <strong>in the same order as the names <code class="docutils literal notranslate"><span class="pre">states</span></code></strong>. The integrate function must be a static method (include the decorator <code class="docutils literal notranslate"><span class="pre">&#64;staticmethod</span></code>).</p></li>
<li><p><strong>dimensions</strong> (list) - optional - Names of the model’s dimensions. Number of dimensions determines the dimensionality of the model’s states.</p>
<ul>
<li><p>No dimensions: states are 0-D (scalar)</p></li>
<li><p>1 dimension: states are 1-D (np.ndarray)</p></li>
<li><p>2 dimensions: states are 2-D (np.ndarray)</p></li>
<li><p>etc.</p></li>
</ul>
</li>
<li><p><strong>stratified_parameters</strong> (list) - optional - Names of the <em>stratified</em> parameters. Stratified parameters must be of type list/1D np.array and their length must be equal to the number of coordinates of the dimension axis it corresponds to. Their use is optional and mainly serves as a way for the user to structure his code.</p>
<ul>
<li><p>0-D model: not possible to have <em>stratified</em> parameters</p></li>
<li><p>1-D model: list containing strings - <code class="docutils literal notranslate"><span class="pre">['stratpar_1',</span> <span class="pre">'stratpar_2']</span></code></p></li>
<li><p>2-D+ dimensions: List contains <em>n</em> sublists, where <em>n</em> is the number of model dimensions. Each sublist contains names of stratified parameters associated with the dimension in the corresponding position in <code class="docutils literal notranslate"><span class="pre">dimensions</span></code> - example for a 3-D model: <code class="docutils literal notranslate"><span class="pre">[['stratpar_1',</span> <span class="pre">'stratpar_2'],[],['stratpar_3']]</span></code>, first dimension in <code class="docutils literal notranslate"><span class="pre">dimensions</span></code> has two stratified parameters <code class="docutils literal notranslate"><span class="pre">stratpar_1</span></code> and <code class="docutils literal notranslate"><span class="pre">stratpar_2</span></code>, second dimension has no stratified parameters, third dimensions has one stratified parameter <code class="docutils literal notranslate"><span class="pre">stratpar_3</span></code>.</p></li>
</ul>
</li>
<li><p><strong>dimensions_per_state</strong> (list) - optional - Specify the dimensions of each model states. Allows users to define models with states of different sizes. If <code class="docutils literal notranslate"><span class="pre">dimensions_per_state</span></code> is not provided, all model states will have the same number of dimensions, equal to the number of model dimensions specified using <code class="docutils literal notranslate"><span class="pre">dimensions</span></code>. If specified, <code class="docutils literal notranslate"><span class="pre">dimensions_per_state</span></code> must contain <em>n</em> sublists, where <em>n</em> is the number of model states (<code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">=</span> <span class="pre">len(states)</span></code>). If a model state has no dimensions (i.e. it is a float), specify an empty list.</p></li>
</ul>
<p>Below is a minimal example of a user-defined model class inheriting <code class="docutils literal notranslate"><span class="pre">ODE</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import the ODE class</span>
<span class="kn">from</span> <span class="nn">pySODM.models.base</span> <span class="kn">import</span> <span class="n">ODE</span>

<span class="c1"># Define the model equations</span>
<span class="k">class</span> <span class="nc">MY_MODEL</span><span class="p">(</span><span class="n">ODE</span><span class="p">):</span>

    <span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;S1&#39;</span><span class="p">,</span> <span class="s1">&#39;S2&#39;</span><span class="p">]</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">alpha</span><span class="o">*</span><span class="n">S1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">*</span><span class="n">S2</span>
</pre></div>
</div>
<p>To intialize the user-defined model class, the following arguments must be provided.</p>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><strong>states</strong> (dict) - Initial states. Keys: names of model states. Values: initial values of model states. The dictionary does not have to contain a key,value pair for all states, missing states are filled with zeros upon initialization.</p></li>
<li><p><strong>parameters</strong> (dict) - Model parameters. Keys: names of parameters. Values: values of parameters. A key,value pair must be provided for all parameter names listed in <code class="docutils literal notranslate"><span class="pre">parameters</span></code> and <code class="docutils literal notranslate"><span class="pre">stratified_parameters</span></code> of the model declaration. If <em>time dependent parameter functions</em> with additional parameters are used, these parameters must be included as well.</p></li>
<li><p><strong>coordinates</strong> (dict) - optional - Keys: names of dimensions (<code class="docutils literal notranslate"><span class="pre">dimensions</span></code>). Values: coordinates of the dimension.</p></li>
<li><p><strong>time_dependent_parameters</strong> (dict) - optional - Keys: name of the model parameter the time-dependent parameter function should be applied to. Must be a valid model parameter. Values: time-dependent parameter function (callable function). Time-dependent parameter functions must have <code class="docutils literal notranslate"><span class="pre">t</span></code> (timestep/data), <code class="docutils literal notranslate"><span class="pre">states</span></code> (dictionary of model states at time <code class="docutils literal notranslate"><span class="pre">t</span></code>) and <code class="docutils literal notranslate"><span class="pre">params</span></code> (model parameters dictionary) as the first three arguments.</p></li>
</ul>
<p>To initalize our user-defined model class,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">MY_MODEL</span><span class="p">(</span><span class="n">states</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;S1&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;S2&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
</pre></div>
</div>
<p><strong>Class methods:</strong></p>
<ul>
<li><p><strong>sim(time, N=1, draw_function=None, draw_function_kwargs={}, processes=None, method=’RK23’, rtol=1e-3, tau=None, output_timestep=1, warmup=0)</strong></p>
<p>Integrate a pySODM model using <code class="docutils literal notranslate"><span class="pre">scipy.integrate.solve_ivp()</span></code>. Can optionally perform <code class="docutils literal notranslate"><span class="pre">N</span></code> repeated simulations. Can change the values of model parameters at every consecutive simulation by manipulating the dictionary of model parameters <code class="docutils literal notranslate"><span class="pre">parameters</span></code> using a <code class="docutils literal notranslate"><span class="pre">draw_function</span></code>.</p>
<p><strong>Parameters</strong></p>
<ul class="simple">
<li><p><strong>time</strong> - (int/float or list) - The start and stop “time” or “date” of the integration. Three possible inputs: 1) an int/float denoting the end of the integration, 2) a list of int/float <code class="docutils literal notranslate"><span class="pre">[start_time,</span> <span class="pre">stop_time]</span></code>, 3) a list of dates (type: <code class="docutils literal notranslate"><span class="pre">datetime</span></code> or a ‘YYYY-MM-DD’ string representation thereof) <code class="docutils literal notranslate"><span class="pre">[start_date,</span> <span class="pre">stop_date]</span></code>.</p></li>
<li><p><strong>N</strong> - (int) - optional - Number of consecutive simulations to perform.</p></li>
<li><p><strong>draw_function</strong> - (function) - optional - A function altering the model parameters dictionary <code class="docutils literal notranslate"><span class="pre">parameters</span></code> between consecutive simulations. Function must have <code class="docutils literal notranslate"><span class="pre">parameters</span></code> as its first input, followed by an arbitrary number of additional parameters. Function must return the model parameters dictionary <code class="docutils literal notranslate"><span class="pre">parameters</span></code> with its keys unaltered, meaning no parameters should be added or removed by a <em>draw function</em>.</p></li>
<li><p><strong>draw_function_kwargs</strong> - (dict) - optional - Dictionary containing the parameters of the <em>draw function</em>, excluding <code class="docutils literal notranslate"><span class="pre">parameters</span></code>. Keys: names of additional parameters <em>draw function</em>, values: values of additional parameters <em>draw function</em>. Not subject to input checks regarding data type.</p></li>
<li><p><strong>processes</strong> - (int) - optional - Number of cores to use when <span class="math notranslate nohighlight">\(N &gt; 1\)</span>.</p></li>
<li><p><strong>method</strong> - (str) - optional - Integration methods of <code class="docutils literal notranslate"><span class="pre">scipy.integrate.solve_ivp()</span></code>, <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.integrate.solve_ivp.html">click to consult scipy’s documentation</a>.</p></li>
<li><p><strong>rtol</strong> - (int/float) - optional - Relative tolerance of <code class="docutils literal notranslate"><span class="pre">scipy.integrate.solve_ivp()</span></code>, <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.integrate.solve_ivp.html">click to consult scipy’s documentation</a>.</p></li>
<li><p><strong>tau</strong> - (int/float) - optional - If <code class="docutils literal notranslate"><span class="pre">tau</span> <span class="pre">!=</span> <span class="pre">None</span></code>, the model is simulated using a simple discrete timestepper with fixed timestep <code class="docutils literal notranslate"><span class="pre">tau</span></code>. Overrides the <code class="docutils literal notranslate"><span class="pre">method</span></code> and <code class="docutils literal notranslate"><span class="pre">rtol</span></code> arguments.</p></li>
<li><p><strong>output_timestep</strong> - (int/float) - optional - Interpolate model output to every <code class="docutils literal notranslate"><span class="pre">output_timestep</span></code> timesteps.</p></li>
<li><p><strong>warmup</strong> - (float) - optional - Number of days to simulate prior to the simulation start. Usefull in epidemiological contexts when the time between the appearance of “patient zero” and the collection of data is be estimated.</p></li>
</ul>
<p><strong>Returns</strong></p>
<ul class="simple">
<li><p><strong>out</strong> - (<a class="reference external" href="https://docs.xarray.dev/en/stable/generated/xarray.Dataset.html#xarray.Dataset">xarray.Dataset</a>) - Simulation output. <code class="docutils literal notranslate"><span class="pre">xarray.Dataset.data_vars</span></code> return the model’s states. <code class="docutils literal notranslate"><span class="pre">xarray.Dataset.dimensions</span></code> returns the temporal dimension plus the model’s dimensions. The time dimension is named <code class="docutils literal notranslate"><span class="pre">time</span></code> if timesteps were numbers, the time dimension is named <code class="docutils literal notranslate"><span class="pre">date</span></code> if timesteps were dates. When <span class="math notranslate nohighlight">\(N &gt; 1\)</span> an additional dimension <code class="docutils literal notranslate"><span class="pre">draws</span></code> is added to accomodate the consecutive simulations.</p></li>
</ul>
</li>
</ul>
</section>
<section id="class-jumpprocess">
<h3><em>class</em> JumpProcess<a class="headerlink" href="#class-jumpprocess" title="Link to this heading">¶</a></h3>
<p><strong>Inherits from the user’s model class:</strong></p>
<ul class="simple">
<li><p><strong>states</strong> (list) - Names of the model’s states.</p></li>
<li><p><strong>parameters</strong> (list) - Names of the model’s parameters. Parameters are not subject to input checks and can have any type.</p></li>
<li><p><strong>compute_rates</strong> (function) - Function returning the rates of transitioning between the model states. <code class="docutils literal notranslate"><span class="pre">compute_rates()</span></code> must have the timestep <code class="docutils literal notranslate"><span class="pre">t</span></code> as its first input, followed by the names <code class="docutils literal notranslate"><span class="pre">states</span></code>, <code class="docutils literal notranslate"><span class="pre">parameters</span></code> and <code class="docutils literal notranslate"><span class="pre">stratified_parameters</span></code> (their order is not important). <code class="docutils literal notranslate"><span class="pre">compute_rates()</span></code> must be a static method (include <code class="docutils literal notranslate"><span class="pre">&#64;staticmethod</span></code>). The output of <code class="docutils literal notranslate"><span class="pre">compute_rates()</span></code> must be a dictionary. Its keys must be valid model states, a rate is only needed for the states undergoing a transitioning. The corresponding values must be a list containing the rates of the possible transitionings of the state. In this way, a model state can have multiple transitionings.</p></li>
<li><p><strong>apply_transitionings</strong> (function) - Function to update the states with the number of drawn transitionings. <code class="docutils literal notranslate"><span class="pre">apply_transitionings()</span></code> must have the timestep <code class="docutils literal notranslate"><span class="pre">t</span></code> as its first input, followed by the solver timestep <code class="docutils literal notranslate"><span class="pre">tau</span></code>, follwed by the dictionary containing the transitionings <code class="docutils literal notranslate"><span class="pre">transitionings</span></code>, then followed by the model states and parameters similarily to <code class="docutils literal notranslate"><span class="pre">compute_rates()</span></code>.</p></li>
<li><p><strong>dimensions</strong> (list) - optional - Names of the model’s dimensions. Number of dimensions determines the dimensionality of the model’s states.</p>
<ul>
<li><p>No dimensions: states are 0-D (scalar)</p></li>
<li><p>1 dimension: states are 1-D (np.ndarray)</p></li>
<li><p>2 dimensions: states are 2-D (np.ndarray)</p></li>
<li><p>etc.</p></li>
</ul>
</li>
<li><p><strong>stratified_parameters</strong> (list) - optional - Names of the <em>stratified</em> parameters. Stratified parameters must be of type list/1D np.array and their length must be equal to the number of coordinates of the dimension axis it corresponds to. Their use is optional and mainly serves as a way for the user to structure his code.</p>
<ul>
<li><p>0-D model: not possible to have <em>stratified</em> parameters</p></li>
<li><p>1-D model: list containing strings - <code class="docutils literal notranslate"><span class="pre">['stratpar_1',</span> <span class="pre">'stratpar_2']</span></code></p></li>
<li><p>2-D+ dimensions: List contains <em>n</em> sublists, where <em>n</em> is the number of model dimensions. Each sublist contains names of stratified parameters associated with the dimension in the corresponding position in <code class="docutils literal notranslate"><span class="pre">dimensions</span></code> - example for a 3-D model: <code class="docutils literal notranslate"><span class="pre">[['stratpar_1',</span> <span class="pre">'stratpar_2'],[],['stratpar_3']]</span></code>, first dimension in <code class="docutils literal notranslate"><span class="pre">dimensions</span></code> has two stratified parameters <code class="docutils literal notranslate"><span class="pre">stratpar_1</span></code> and <code class="docutils literal notranslate"><span class="pre">stratpar_2</span></code>, second dimension has no stratified parameters, third dimensions has one stratified parameter <code class="docutils literal notranslate"><span class="pre">stratpar_3</span></code>.</p></li>
</ul>
</li>
<li><p><strong>dimensions_per_state</strong> (list) - optional - Specify the dimensions of each model states. Allows users to define models with states of different sizes. If <code class="docutils literal notranslate"><span class="pre">dimensions_per_state</span></code> is not provided, all model states will have the same number of dimensions, equal to the number of model dimensions specified using <code class="docutils literal notranslate"><span class="pre">dimensions</span></code>. If specified, <code class="docutils literal notranslate"><span class="pre">dimensions_per_state</span></code> must contain <em>n</em> sublists, where <em>n</em> is the number of model states (<code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">=</span> <span class="pre">len(states)</span></code>). If a model state has no dimensions (i.e. it is a float), specify an empty list.</p></li>
</ul>
<p>Below is a minimal example of a user-defined model class inheriting <code class="docutils literal notranslate"><span class="pre">JumpProcesses</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import the JumpProcesses class</span>
<span class="kn">from</span> <span class="nn">pySODM.models.base</span> <span class="kn">import</span> <span class="n">JumpProcesses</span>

<span class="k">class</span> <span class="nc">MY_MODEL</span><span class="p">(</span><span class="n">JumpProcesses</span><span class="p">):</span>

    <span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;S1&#39;</span><span class="p">,</span> <span class="s1">&#39;S2&#39;</span><span class="p">]</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>

    <span class="c1"># define the rates of the system&#39;s transitionings</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">compute_rates</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;S1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">alpha</span><span class="p">,</span> <span class="p">]}</span>

    <span class="c1"># apply the sampled number of transitionings</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">apply_transitionings</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">transitionings</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>

        <span class="n">S1_new</span> <span class="o">=</span> <span class="n">S1</span> <span class="o">-</span> <span class="n">transitionings</span><span class="p">[</span><span class="s1">&#39;S1&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">S2_new</span> <span class="o">=</span> <span class="n">S2</span> <span class="o">+</span> <span class="n">transitionings</span><span class="p">[</span><span class="s1">&#39;S2&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">S1_new</span><span class="p">,</span> <span class="n">S2_new</span>
</pre></div>
</div>
<p>To intialize the user-defined model class, the following arguments must be provided.</p>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><strong>states</strong> (dict) - Initial states. Keys: names of model states. Values: initial values of model states. The dictionary does not have to contain a key,value pair for all states, missing states are filled with zeros upon initialization.</p></li>
<li><p><strong>parameters</strong> (dict) - Model parameters. Keys: names of parameters. Values: values of parameters. A key,value pair must be provided for all parameter names listed in <code class="docutils literal notranslate"><span class="pre">parameters</span></code> and <code class="docutils literal notranslate"><span class="pre">stratified_parameters</span></code> of the model declaration. If <em>time dependent parameter functions</em> with additional parameters are used, these parameters must be included as well.</p></li>
<li><p><strong>coordinates</strong> (dict) - optional - Keys: names of dimensions (<code class="docutils literal notranslate"><span class="pre">dimensions</span></code>). Values: coordinates of the dimension.</p></li>
<li><p><strong>time_dependent_parameters</strong> (dict) - optional - Keys: name of the model parameter the time-dependent parameter function should be applied to. Must be a valid model parameter. Values: time-dependent parameter function (callable function). Time-dependent parameter functions must have <code class="docutils literal notranslate"><span class="pre">t</span></code> (timestep/data), <code class="docutils literal notranslate"><span class="pre">states</span></code> (dictionary of model states at time <code class="docutils literal notranslate"><span class="pre">t</span></code>) and <code class="docutils literal notranslate"><span class="pre">params</span></code> (model parameters dictionary) as the first three arguments.</p></li>
</ul>
<p>To initalize our user-defined model class,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">MY_MODEL</span><span class="p">(</span><span class="n">states</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;S1&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;S2&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
</pre></div>
</div>
<p><strong>Methods:</strong></p>
<ul>
<li><p><strong>sim(time, N=1, draw_function=None, draw_function_kwargs={}, processes=None, method=’tau_leap’, tau=0.5, output_timestep=1, warmup=0)</strong></p>
<p>Integrate a model stochastically using Gillespie’s Stochastic Simulation Algorithm (SSA) or the approximate Tau-leaping method. Can optionally perform <code class="docutils literal notranslate"><span class="pre">N</span></code> repeated simulations. Can change the values of model parameters at every consecutive simulation by manipulating the dictionary of model parameters <code class="docutils literal notranslate"><span class="pre">parameters</span></code> using a <code class="docutils literal notranslate"><span class="pre">draw_function</span></code>.</p>
<p><strong>Parameters</strong></p>
<ul class="simple">
<li><p><strong>time</strong> - (int/float or list) - The start and stop “time” or “date” of the integration. Three possible inputs: 1) an int/float denoting the end of the integration, 2) a list of int/float <code class="docutils literal notranslate"><span class="pre">[start_time,</span> <span class="pre">stop_time]</span></code>, 3) a list of dates (type: <code class="docutils literal notranslate"><span class="pre">datetime</span></code> or a ‘YYYY-MM-DD’ string representation thereof) <code class="docutils literal notranslate"><span class="pre">[start_date,</span> <span class="pre">stop_date]</span></code>.</p></li>
<li><p><strong>N</strong> - (int) - optional - Number of consecutive simulations to perform.</p></li>
<li><p><strong>draw_function</strong> - (function) - optional - A function altering the model parameters dictionary <code class="docutils literal notranslate"><span class="pre">parameters</span></code> between consecutive simulations. Function must have <code class="docutils literal notranslate"><span class="pre">parameters</span></code> as its first input, followed by an arbitrary number of additional parameters. Function must return the model parameters dictionary <code class="docutils literal notranslate"><span class="pre">parameters</span></code> with its keys unaltered, meaning no parameters should be added or removed by a <em>draw function</em>.</p></li>
<li><p><strong>draw_function_kwargs</strong> - (dict) - optional - Dictionary containing the parameters of the <em>draw function</em>, excluding <code class="docutils literal notranslate"><span class="pre">parameters</span></code>. Keys: names of additional parameters <em>draw function</em>, values: values of additional parameters <em>draw function</em>. Not subject to input checks regarding data type.</p></li>
<li><p><strong>processes</strong> - (int) - optional - Number of cores to use when <span class="math notranslate nohighlight">\(N &gt; 1\)</span>.</p></li>
<li><p><strong>method</strong> - (str) - optional - ‘SSA’: Stochastic Simulation Algorithm. ‘tau-leap’: Tau-leaping algorithm. Consult the <a class="reference external" href="https://lewiscoleblog.com/gillespie-algorithm">following blog</a> for more background information. #TODO: add an adaptive tau-leap algorithm.</p></li>
<li><p><strong>tau</strong> - (int/float) - optional - Leap value of the tau-leaping method. Consult the following <a class="reference external" href="https://lewiscoleblog.com/gillespie-algorithm">blog</a> for more background information.</p></li>
<li><p><strong>output_timestep</strong> - (int/float) - optional - Interpolate model output to every <code class="docutils literal notranslate"><span class="pre">output_timestep</span></code> timesteps. For datetimes: expressed in days.</p></li>
<li><p><strong>warmup</strong> - (float) - optional - Number of days to simulate prior to the simulation start. Usefull in epidemiological contexts when the time between the appearance of “patient zero” and the collection of data is be estimated.</p></li>
</ul>
<p><strong>Returns</strong></p>
<ul class="simple">
<li><p><strong>out</strong> - (<a class="reference external" href="https://docs.xarray.dev/en/stable/generated/xarray.Dataset.html#xarray.Dataset">xarray.Dataset</a>) - Simulation output. <code class="docutils literal notranslate"><span class="pre">xarray.Dataset.data_vars</span></code> return the model’s states. <code class="docutils literal notranslate"><span class="pre">xarray.Dataset.dimensions</span></code> returns the temporal dimension plus the model’s dimensions. The time dimension is named <code class="docutils literal notranslate"><span class="pre">time</span></code> if timesteps were numbers, the time dimension is named <code class="docutils literal notranslate"><span class="pre">date</span></code> if timesteps were dates. When <span class="math notranslate nohighlight">\(N &gt; 1\)</span> an additional dimension <code class="docutils literal notranslate"><span class="pre">draws</span></code> is added to accomodate the consecutive simulations.</p></li>
</ul>
</li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="references.html" class="btn btn-neutral float-left" title="Additional references" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="optimization.html" class="btn btn-neutral float-right" title="Optimization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Tijs Alleman.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>