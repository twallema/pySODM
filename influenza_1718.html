<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>An SDE Model for the 2017-2018 Influenza Season in Belgium &mdash; pySODM  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Additional references" href="references.html" />
    <link rel="prev" title="A model for the enzymatic esterification of D-glucose and Lauric acid in a continuous-flow reactor" href="enzyme_kinetics.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            pySODM
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow.html">Modeling and calibration workflow</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Case studies</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="enzyme_kinetics.html">Enzyme kinetics</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Influenza 2017-2018</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#data">Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#model-dynamics-equations-and-parameters">Model dynamics, equations and parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#coding-it-up">Coding it up</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-model">The model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#social-contact-function">Social contact function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#initializing-the-model">Initializing the model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#calibration">Calibration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#results-and-discussion">Results and discussion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="references.html">Additional references</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="optimization.html">Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="speedup.html">Speeding up models</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="start_to_collaborate.html">Start to collaborate</a></li>
<li class="toctree-l1"><a class="reference internal" href="guidelines.html">Contribution guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="git_workflow.html">Git workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pySODM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">An SDE Model for the 2017-2018 Influenza Season in Belgium</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/influenza_1718.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="an-sde-model-for-the-2017-2018-influenza-season-in-belgium">
<h1>An SDE Model for the 2017-2018 Influenza Season in Belgium<a class="headerlink" href="#an-sde-model-for-the-2017-2018-influenza-season-in-belgium" title="Permalink to this heading">¶</a></h1>
<p>In this tutorial, we’ll set up a stochastic age-stratified model for seasonal Influenza in Belgium. First, we’ll expand the dynamics of the <a class="reference internal" href="workflow.html"><span class="doc std std-doc">simple SIR model</span></a> to account for additional charateristics of seasonal Influenza and we’ll use the concept of <em>dimensions</em> to include four age groups in our model. Opposed to the simple SIR tutorial, where changes in the number of social contacts were not considered, we’ll use a <em>time-dependent parameter function</em> to include the effects of school closures during school holidays in our Influenza model. Finally, we’ll calibrate two of the model’s parameters to incrementally larger sets of incidence data and asses how the goodness-of-fit evolves with the amount of knowledge at our disposal. One of the calibrated model parameters is a 1D vector, pySODM allows users to easily calibrate n-dimensional model parameters.</p>
<p>This tutorial introduces the following concepts,</p>
<ul class="simple">
<li><p>Building a stochastic model and solving it with Gillespie’s Tau-Leaping method</p></li>
<li><p>Stratifying an epidemiological model to include age groups</p></li>
<li><p>Calibrating n-D parameters to n-D datasets</p></li>
</ul>
<p>This tutorial can be replicated using <code class="docutils literal notranslate"><span class="pre">~/tutorials/influenza_1718/calibration.py</span></code></p>
<section id="data">
<h2>Data<a class="headerlink" href="#data" title="Permalink to this heading">¶</a></h2>
<p>Data on the weekly incidence of visits to General Practictioners (GP) are made publically available by the Belgian Scientific Institute of Public Health (Sciensano). These data were retrieved from the “End of season” report on Influenza in Belgium (see <code class="docutils literal notranslate"><span class="pre">data/raw/Influenza</span> <span class="pre">2017-2018</span> <span class="pre">End</span> <span class="pre">of</span> <span class="pre">Season_NL.pdf</span></code>). Using <a class="reference external" href="https://automeris.io/WebPlotDigitizer/">Webplotdigitizer</a>, the weekly number of GP visits in the different age groups were extracted (see <code class="docutils literal notranslate"><span class="pre">data/raw/dataset_influenza_1718.csv</span></code>). Then, the script <code class="docutils literal notranslate"><span class="pre">data_conversion.py</span></code> was used to convert the <em>raw</em> weekly incidence of Influenza cases in Belgium (per 100K inhabitats) during the 2017-2018 Influenza season into a better suited format. The weekly incidence was first converted to the absolute GP visits count by multipying with the demographics. Then, it was assumed that the weekly incidence was the sum of seven equal counts throughout the week preceding the data collection, and hence the weekly data were divided by seven. The formatted data are located in <code class="docutils literal notranslate"><span class="pre">data/interim/data_influenza_1718_format.csv</span></code>.</p>
<p><img alt="data" src="_images/data.png" /></p>
<p>The data are loaded in our calibration script <code class="docutils literal notranslate"><span class="pre">~/tutorials/influenza_1718/calibration.py</span></code> as a <code class="docutils literal notranslate"><span class="pre">pd.DataFrame</span></code> with a <code class="docutils literal notranslate"><span class="pre">pd.Multiindex</span></code>. The <code class="docutils literal notranslate"><span class="pre">time</span></code>/<code class="docutils literal notranslate"><span class="pre">date</span></code> axis is obligatory. The other index names and values are the same as the model’s dimensions and coordinates. In this way, pySODM recognizes how model prediction and dataset must be aligned.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>date<span class="w">        </span>age_group
<span class="m">2017</span>-11-27<span class="w">  </span><span class="o">(</span><span class="m">0</span>,<span class="w"> </span><span class="m">5</span><span class="o">]</span><span class="w">        </span><span class="m">15</span>.373303
<span class="w">            </span><span class="o">(</span><span class="m">5</span>,<span class="w"> </span><span class="m">15</span><span class="o">]</span><span class="w">       </span><span class="m">13</span>.462340
<span class="w">            </span><span class="o">(</span><span class="m">15</span>,<span class="w"> </span><span class="m">65</span><span class="o">]</span><span class="w">     </span><span class="m">409</span>.713333
<span class="w">            </span><span class="o">(</span><span class="m">65</span>,<span class="w"> </span><span class="m">120</span><span class="o">]</span><span class="w">     </span><span class="m">33</span>.502705
<span class="w">                            </span>...<span class="w">    </span>
<span class="m">2018</span>-05-07<span class="w">  </span><span class="o">(</span><span class="m">0</span>,<span class="w"> </span><span class="m">5</span><span class="o">]</span><span class="w">         </span><span class="m">0</span>.000000
<span class="w">            </span><span class="o">(</span><span class="m">5</span>,<span class="w"> </span><span class="m">15</span><span class="o">]</span><span class="w">        </span><span class="m">0</span>.000000
<span class="w">            </span><span class="o">(</span><span class="m">15</span>,<span class="w"> </span><span class="m">65</span><span class="o">]</span><span class="w">       </span><span class="m">0</span>.000000
<span class="w">            </span><span class="o">(</span><span class="m">65</span>,<span class="w"> </span><span class="m">120</span><span class="o">]</span><span class="w">      </span><span class="m">0</span>.000000
Name:<span class="w"> </span>CASES,<span class="w"> </span>Length:<span class="w"> </span><span class="m">96</span>,<span class="w"> </span>dtype:<span class="w"> </span>float64
</pre></div>
</div>
<blockquote>
<div><p><strong>NOTE</strong> If we’d stratify our model further to include spatial patches, we could still calibrate the model to the DataFrame above. pySODM would, by default, sum over the model’s spatial axis to align the prediction with the data. This automatic summation can be replaced with a user-defined function, see input argument <code class="docutils literal notranslate"><span class="pre">aggregation_function</span></code> of <code class="docutils literal notranslate"><span class="pre">log_posterior_distribution</span></code>.</p>
</div></blockquote>
</section>
<section id="model-dynamics-equations-and-parameters">
<h2>Model dynamics, equations and parameters<a class="headerlink" href="#model-dynamics-equations-and-parameters" title="Permalink to this heading">¶</a></h2>
<p>We’ll extend the SIR model by making two changes. First, we’ll add an <em>exposed</em> state (E), to account for the latent phase between the moment of infection and the onset of infectiousness. Second, we’ll split the <em>infectious</em> state (I) in two to account that not all infectious individuals visit a GP and remain undetected. We’ll include a state for individuals who are infectious but remain undetected (Ia), either because these individuals have no symptoms, or these individuals don’t visit the general practicioner (GP), and, we’ll include a state for individuals who are infectious and go to the GP (Im).</p>
<img src="./_static/figs/influenza_1718/flowchart.png" width="500" />
<p>We’ll simulate these dynamics stochastically with Gillespie’s Tau-Leaping method. Instead of defining a differential equation for every model state, we need to define the rates of all possible transitionings in the system,</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{cases}
T^i &amp;=&amp; S^i + E^i + I_a^i + I_m^i + R^i,\\
\mathcal{R}(S \rightarrow E_i)^i &amp;=&amp; \beta \sum_j N^{ij} \dfrac{(I_a^j + I_m^j)}{T^j},\\
\mathcal{R}(E \rightarrow I_a)^i &amp;=&amp; \dfrac{f_a^i}{\sigma}, \\
\mathcal{R}(E \rightarrow I_m)^i &amp;=&amp; \dfrac{1-f_a^i}{\sigma}, \\
\mathcal{R}(I_a \rightarrow R)^i &amp;=&amp; \dfrac{1}{\gamma}, \\
\mathcal{R}(I_m \rightarrow R)^i &amp;=&amp; \dfrac{1}{\gamma}, 
\end{cases}\end{split}\]</div>
<p>here, the subscript <span class="math notranslate nohighlight">\(i\)</span> refers to the model’s age groups: <span class="math notranslate nohighlight">\([0,5(, [5,15(, [15,65(,\text{ and } [65,120(\)</span> years old. <span class="math notranslate nohighlight">\(S\)</span> denotes the number of individuals suceptible to the disease, <span class="math notranslate nohighlight">\(E\)</span> denotes the number of exposed individuals, <span class="math notranslate nohighlight">\(I_a\)</span> denotes the number of infectious but undetected individuals and <span class="math notranslate nohighlight">\(I_m\)</span> denotes the number of infectious individuals who visit the GP and <span class="math notranslate nohighlight">\(R\)</span> denotes the number of removed individuals, either through death or recovery. The model has five parameters,</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\beta\)</span> : Per-contact chance of Influenza transmission. Calibrated.</p></li>
<li><p><span class="math notranslate nohighlight">\(N^{ij}\)</span> : Square origin-destination matrix containing the number of social contacts in age group <span class="math notranslate nohighlight">\(i\)</span> with individuals from age group <span class="math notranslate nohighlight">\(j\)</span>. Extracted from <a class="reference external" href="http://www.socialcontactdata.org/socrates/">Socrates</a>. Dataset: Hoang, Belgium, 2010. Physical contacts with a duration of 15+ minutes only.</p></li>
<li><p><span class="math notranslate nohighlight">\(f_a^i\)</span> : Age-stratified fraction of undetected cases. Calibrated.</p></li>
<li><p><span class="math notranslate nohighlight">\(\sigma\)</span> : Length of the latent phase, assumed equal to two days.</p></li>
<li><p><span class="math notranslate nohighlight">\(\gamma\)</span> : Length of infectiousness, assumed equal to five days.</p></li>
</ul>
<p>Assuming these rates are exponentially distributed, the probability of a single transition from a generic state A to B in age class <span class="math notranslate nohighlight">\(i\)</span> happening between time <span class="math notranslate nohighlight">\(t\)</span> and <span class="math notranslate nohighlight">\(t+\tau\)</span>, is,</p>
<div class="math notranslate nohighlight">
\[\mathcal{P}(A \rightarrow B)^i = 1 - e^{- \tau*\mathcal{R}(A \rightarrow B)^i}.\]</div>
<p>The corresponding number of transitions <span class="math notranslate nohighlight">\(A \rightarrow B\)</span> in age class <span class="math notranslate nohighlight">\(i\)</span> and between time <span class="math notranslate nohighlight">\(t\)</span> and <span class="math notranslate nohighlight">\(t + \tau\)</span> are then generated by drawing from a binomial distribution,</p>
<div class="math notranslate nohighlight">
\[\mathcal{N}(A \rightarrow B)^i = Binom(\mathcal{P}(A \rightarrow B)^i, A^i).\]</div>
<p>The number of individuals in each of the compartments at time <span class="math notranslate nohighlight">\(t + \tau\)</span> is then given by,</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{cases}
S^i(t+\tau) &amp;=&amp; S^i(t) - \mathcal{N}(S \rightarrow E)^i,\\
E^i(t+\tau) &amp;=&amp; E^i(t) + \mathcal{N}(S \rightarrow E)^i - \mathcal{N}(E \rightarrow I_a)^i - \mathcal{N}(E \rightarrow I_m)^i,\\
I_a^i(t+\tau) &amp;=&amp; I_a^i(t) + \mathcal{N}(E \rightarrow I_a)^i - \mathcal{N}(I_a \rightarrow R)^i, \\
I_m^i(t+\tau) &amp;=&amp; I_m^i(t) + \mathcal{N}(E \rightarrow I_m)^i - \mathcal{N}(I_m \rightarrow R)^i, \\
R^i(t+\tau) &amp;=&amp; R^i(t) + \mathcal{N}(I_a \rightarrow R)^i + \mathcal{N}(I_a \rightarrow R)^i,
\end{cases}\end{split}\]</div>
</section>
<section id="coding-it-up">
<h2>Coding it up<a class="headerlink" href="#coding-it-up" title="Permalink to this heading">¶</a></h2>
<section id="the-model">
<h3>The model<a class="headerlink" href="#the-model" title="Permalink to this heading">¶</a></h3>
<p>Opposed to ODE models, where the user had to define an <code class="docutils literal notranslate"><span class="pre">integrate()</span></code> function to compute the values of the derivatives at time <span class="math notranslate nohighlight">\(t\)</span>, the user will have to define <a class="reference internal" href="models.html"><span class="doc std std-doc">two functions</span></a> to setup an SDE model: 1) A function to compute the rates at time <span class="math notranslate nohighlight">\(t\)</span> named <code class="docutils literal notranslate"><span class="pre">compute_rates()</span></code>, and 2) A function to compute the values of the model states at time <span class="math notranslate nohighlight">\(t+\tau\)</span> named <code class="docutils literal notranslate"><span class="pre">apply_transitionings()</span></code>. As we did in the <a class="reference internal" href="enzyme_kinetics.html"><span class="doc std std-doc">packed-bed continuous flow reactor</span></a> tutorial, we’ll stratifiy the model into age groups by specifying a variable <code class="docutils literal notranslate"><span class="pre">dimension_names</span></code> in our model declaration and we’ll implement the parameter <span class="math notranslate nohighlight">\(f_a\)</span> as a stratified parameter by specifying a variable <code class="docutils literal notranslate"><span class="pre">parameter_stratified_names</span></code>. <strong>As dimension name, we use the same name as the age dimension in the dataset: <code class="docutils literal notranslate"><span class="pre">'age_group'</span></code>. The coordinates of the dimension will be defined later when the model is initialized, we’ll have to use the same coordinates as the dataset.</strong> As in the <a class="reference internal" href="enzyme_kinetics.html"><span class="doc std std-doc">enzyme kinetics tutorial</span></a>, we’ll group our model in a file called <code class="docutils literal notranslate"><span class="pre">models.py</span></code> to reduce the complexity of our calibration script. We introduce one additional state in the model, the incidence of new detected cases, <code class="docutils literal notranslate"><span class="pre">I_m_inc</span></code>, which we’ll use this state to match our data to.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pySODM.models.base</span> <span class="kn">import</span> <span class="n">SDEModel</span>

<span class="k">class</span> <span class="nc">SDE_influenza_model</span><span class="p">(</span><span class="n">SDEModel</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple stochastic SEIR model for influenza with undetected carriers</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">state_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;Ia&#39;</span><span class="p">,</span><span class="s1">&#39;Im&#39;</span><span class="p">,</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="s1">&#39;Im_inc&#39;</span><span class="p">]</span>
    <span class="n">parameter_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">,</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span><span class="s1">&#39;gamma&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">]</span>
    <span class="n">parameter_stratified_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;f_a&#39;</span><span class="p">]</span>
    <span class="n">dimension_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;age_group&#39;</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">compute_rates</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">Ia</span><span class="p">,</span> <span class="n">Im</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">Im_inc</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">f_a</span><span class="p">):</span>

        <span class="c1"># Calculate total population</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">S</span><span class="o">+</span><span class="n">E</span><span class="o">+</span><span class="n">Ia</span><span class="o">+</span><span class="n">Im</span><span class="o">+</span><span class="n">R</span>

        <span class="c1"># Compute rates per model state</span>
        <span class="n">rates</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">beta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="p">(</span><span class="n">Ia</span><span class="o">+</span><span class="n">Im</span><span class="p">)</span><span class="o">/</span><span class="n">T</span><span class="p">),],</span>
            <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">f_a</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">sigma</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">f_a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">sigma</span><span class="p">)],</span>
            <span class="s1">&#39;Ia&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">1</span><span class="o">/</span><span class="n">gamma</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">shape</span><span class="p">),],</span>
            <span class="s1">&#39;Im&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">1</span><span class="o">/</span><span class="n">gamma</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">shape</span><span class="p">),],</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">rates</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">apply_transitionings</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">transitionings</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">Ia</span><span class="p">,</span> <span class="n">Im</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">Im_inc</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">f_a</span><span class="p">):</span>

        <span class="n">S_new</span>  <span class="o">=</span> <span class="n">S</span> <span class="o">-</span> <span class="n">transitionings</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">E_new</span> <span class="o">=</span> <span class="n">E</span> <span class="o">+</span> <span class="n">transitionings</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">transitionings</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">transitionings</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">Ia_new</span> <span class="o">=</span> <span class="n">Ia</span> <span class="o">+</span> <span class="n">transitionings</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">transitionings</span><span class="p">[</span><span class="s1">&#39;Ia&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Im_new</span> <span class="o">=</span> <span class="n">Im</span> <span class="o">+</span> <span class="n">transitionings</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">transitionings</span><span class="p">[</span><span class="s1">&#39;Im&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">R_new</span> <span class="o">=</span> <span class="n">R</span> <span class="o">+</span> <span class="n">transitionings</span><span class="p">[</span><span class="s1">&#39;Ia&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">transitionings</span><span class="p">[</span><span class="s1">&#39;Im&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Im_inc_new</span> <span class="o">=</span> <span class="n">transitionings</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">S_new</span><span class="p">,</span> <span class="n">E_new</span><span class="p">,</span> <span class="n">Ia_new</span><span class="p">,</span> <span class="n">Im_new</span><span class="p">,</span> <span class="n">R_new</span><span class="p">,</span> <span class="n">Im_inc_new</span>
</pre></div>
</div>
<p>There are some formatting requirements to <code class="docutils literal notranslate"><span class="pre">compute_rates()</span></code> and <code class="docutils literal notranslate"><span class="pre">apply_transitionings()</span></code>, which are listed in the <a class="reference internal" href="models.html"><span class="doc std std-doc">SDEModel documentation</span></a>.</p>
<p>The actual drawing of the transitionings is abstracted away from the user in the <code class="docutils literal notranslate"><span class="pre">SDEModel</span></code> class. Two stochastic simulation algorithms are currently available. In this tutorial, we’ll use the Tau-Leaping method, where the value of <code class="docutils literal notranslate"><span class="pre">tau</span></code> is fixed and the number of transitionings in the interval <code class="docutils literal notranslate"><span class="pre">t</span></code> and <code class="docutils literal notranslate"><span class="pre">t</span> <span class="pre">+</span> <span class="pre">\tau</span></code> are drawn from a binomial distribution. This method is an approximation of the Stochastic Simulation Algorithm (SSA), where the time until the first transitioning <code class="docutils literal notranslate"><span class="pre">tau</span></code> is computed and only one transitioning can happen at every simulation step. However, as we aim to simulate a large number of individuals (11 million individuals), the time between transitionings becomes very small and the SSA becomes computationally too demanding. Good values for <code class="docutils literal notranslate"><span class="pre">tau</span></code> are typically found by balancing the use of computational resources against numerical stability.</p>
</section>
<section id="social-contact-function">
<h3>Social contact function<a class="headerlink" href="#social-contact-function" title="Permalink to this heading">¶</a></h3>
<p>The number of work and school contacts tends to change during school holidays and this has an effect on Influenza spread. We’ll thus use a <em>time-dependent parameter function</em> to vary the number of social contacts <span class="math notranslate nohighlight">\(\mathbf{N}\)</span> during the simulation. We’ll wrap our <code class="docutils literal notranslate"><span class="pre">contact_function()</span></code> in a class for the sake of user friendliness. The initialization of the class is used to store the contact matrix during holidays and non-holidays. The callable function <code class="docutils literal notranslate"><span class="pre">__call__</span></code> is used to return the right contact matrix. Notice the decorator <code class="docutils literal notranslate"><span class="pre">&#64;lru_cache()</span></code>, which loads the contact matrices in working memory so these have to be read only once during the simulation. The <code class="docutils literal notranslate"><span class="pre">contact_function()</span></code> is the actual pySODM-compatible <em>time-dependent parameter function</em>, which implements the social policies. We’ll add our TDPF to the <code class="docutils literal notranslate"><span class="pre">models.py</span></code> script.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">make_contact_matrix_function</span><span class="p">():</span>

    <span class="c1"># Initialize class with contact matrices</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">N_holiday</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">N</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N_holiday</span> <span class="o">=</span> <span class="n">N_holiday</span>

    <span class="c1"># Define a call function to return the right contact matrix</span>
    <span class="nd">@lru_cache</span><span class="p">()</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">holiday</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">holiday</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_holiday</span>

    <span class="c1"># Define a pySODM compatible wrapper with the social policies</span>
    <span class="k">def</span> <span class="nf">contact_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">states</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">ramp_time</span><span class="p">):</span>

        <span class="n">delay</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">ramp_time</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2017-12-20&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">delay</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="c1"># Christmass holiday</span>
        <span class="k">elif</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2017-12-20&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">delay</span> <span class="o">&lt;</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2018-01-05&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">delay</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">holiday</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># Christmass holiday --&gt; Winter holiday</span>
        <span class="k">elif</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2018-01-05&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">delay</span> <span class="o">&lt;</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2018-02-10&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">delay</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="c1"># Winter holiday</span>
        <span class="k">elif</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2018-02-10&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">delay</span> <span class="o">&lt;</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2018-02-18&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">delay</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">holiday</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Winter holiday --&gt; Easter holiday</span>
        <span class="k">elif</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2018-02-18&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">delay</span> <span class="o">&lt;</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2018-03-28&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">delay</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="c1"># Easter holiday</span>
        <span class="k">elif</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2018-03-28&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">delay</span> <span class="o">&lt;</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2018-04-16&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">delay</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">holiday</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="initializing-the-model">
<h3>Initializing the model<a class="headerlink" href="#initializing-the-model" title="Permalink to this heading">¶</a></h3>
<p>Next, we’ll set the model up in our calibration script <code class="docutils literal notranslate"><span class="pre">~/tutorials/influenza_1718/calibration.py</span></code>. We load the model and social contact function from <code class="docutils literal notranslate"><span class="pre">models.py</span></code> and initialize the contact matrix function using the social contact matrices (hardcoded in the example). Then, as always, we define the model parameters, initial states (obtained analytically so the differentials are zero at <span class="math notranslate nohighlight">\(t=0\)</span>) and coordinates. <strong>The coordinates for dimension <code class="docutils literal notranslate"><span class="pre">age_groups</span></code> must be the same as the dataset: <code class="docutils literal notranslate"><span class="pre">pd.IntervalIndex.from_tuples([(0,5),(5,15),(15,65),(65,120)]</span></code></strong>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># Load model</span>
<span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">SDE_influenza_model</span> <span class="k">as</span> <span class="n">influenza_model</span>

<span class="c1"># Load TDPF</span>
<span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">make_contact_matrix_function</span>

<span class="c1"># Hardcode the contact matrices</span>
<span class="n">N_noholiday</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">N_holiday</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1"># Initialize contact function</span>
<span class="n">contact_function</span> <span class="o">=</span> <span class="n">make_contact_matrix_function</span><span class="p">(</span><span class="n">Nc_work</span><span class="p">,</span> <span class="n">Nc_school</span><span class="p">,</span> <span class="n">Nc_except_workschool</span><span class="p">)</span><span class="o">.</span><span class="n">contact_function</span>

<span class="c1"># Define model parameters</span>
<span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;beta&#39;</span><span class="p">:</span> <span class="mf">0.034</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;f_a&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.63</span><span class="p">,</span> <span class="mf">0.88</span><span class="p">,</span> <span class="mf">0.76</span><span class="p">]),</span> <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="n">N_except_workschool</span><span class="o">+</span><span class="n">N_school</span><span class="o">+</span><span class="n">N_work</span><span class="p">}</span>

<span class="c1"># Define initial condition</span>
<span class="n">init_states</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">initN</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
               <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;f_a&#39;</span><span class="p">]))</span><span class="o">*</span><span class="n">df_influenza</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">start_calibration</span><span class="p">,</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)]),</span>
               <span class="s1">&#39;Ia&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">((</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;f_a&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;f_a&#39;</span><span class="p">]))</span><span class="o">*</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">df_influenza</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">start_calibration</span><span class="p">,</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)]),</span>
               <span class="s1">&#39;Im&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">df_influenza</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">start_calibration</span><span class="p">,</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)]),</span>
               <span class="s1">&#39;Im_inc&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_influenza</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">start_calibration</span><span class="p">,</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)])}</span>

<span class="c1"># Define model coordinates</span>
<span class="n">coordinates</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;age_group&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">IntervalIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">),(</span><span class="mi">5</span><span class="p">,</span><span class="mi">15</span><span class="p">),(</span><span class="mi">15</span><span class="p">,</span><span class="mi">65</span><span class="p">),(</span><span class="mi">65</span><span class="p">,</span><span class="mi">120</span><span class="p">)])}</span>

<span class="c1"># Initialize model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">influenza_model</span><span class="p">(</span><span class="n">init_states</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">coordinates</span><span class="p">,</span><span class="n">time_dependent_parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="n">contact_function</span><span class="p">})</span>
</pre></div>
</div>
</section>
<section id="calibration">
<h3>Calibration<a class="headerlink" href="#calibration" title="Permalink to this heading">¶</a></h3>
<p>We aim to calibrate two model parameters: <span class="math notranslate nohighlight">\(\beta\)</span> and <span class="math notranslate nohighlight">\(\mathbf{f_a}\)</span>. However, <span class="math notranslate nohighlight">\(\mathbf{f_a}\)</span> consists of four elements <span class="math notranslate nohighlight">\(f_a^i\)</span>, how does pySODM handle this?</p>
<p>As if nothing’s up,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="kn">from</span> <span class="nn">pySODM.optimization.objective_functions</span> <span class="kn">import</span> <span class="n">log_posterior_probability</span><span class="p">,</span> <span class="n">ll_negative_binomial</span>

    <span class="c1"># Define dataset</span>
    <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">df_influenza</span><span class="p">[</span><span class="n">start_date</span><span class="p">:</span><span class="n">end_calibration</span><span class="p">],</span> <span class="p">]</span>
    <span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Im_inc&quot;</span><span class="p">,]</span>
    <span class="n">log_likelihood_fnc</span> <span class="o">=</span> <span class="p">[</span><span class="n">ll_negative_binomial</span><span class="p">,]</span>
    <span class="n">log_likelihood_fnc_args</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="o">*</span><span class="p">[</span><span class="mf">0.03</span><span class="p">,],]</span>

    <span class="c1"># Calibated parameters and bounds</span>
    <span class="n">pars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="s1">&#39;f_a&#39;</span><span class="p">]</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">beta$&#39;</span><span class="p">,</span> <span class="s1">&#39;$f_a$&#39;</span><span class="p">]</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">1e-6</span><span class="p">,</span><span class="mf">0.06</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.99</span><span class="p">)]</span>

    <span class="c1"># Setup objective function (no priors --&gt; uniform priors based on bounds)</span>
    <span class="n">objective_function</span> <span class="o">=</span> <span class="n">log_posterior_probability</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">states</span><span class="p">,</span> <span class="n">log_likelihood_fnc</span><span class="p">,</span> <span class="n">log_likelihood_fnc_args</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
<p>In the example above, bounds and labels of <span class="math notranslate nohighlight">\(\mathbf{f_a}\)</span> are automatically expanded to the right size when the log posterior probability function is initialized. However, I have retained the possibility of supplying a bound and label per element of <span class="math notranslate nohighlight">\(\mathbf{f_a}\)</span>. Running the NM/PSO and MCMC optimizations happens in the same manner as the other tutorials.</p>
</section>
</section>
<section id="results-and-discussion">
<h2>Results and discussion<a class="headerlink" href="#results-and-discussion" title="Permalink to this heading">¶</a></h2>
<p>We’re now ready to generate our results, we’ll first calibrate the model using data up until December 15th, 2017, thus, only two datapoints are available. Then, we’ll calibrate the model to data until January 1st, 2018, well before the peak incidence around mid February, 2018. The, we’ll increase the amount of available data until February 1st, 2018 and then March 1st, 2018, representing the moment right before, and right after, the peak incidence. Let’s first have a look at the sampled distributions of <span class="math notranslate nohighlight">\(\beta\)</span> and <span class="math notranslate nohighlight">\(\mathbf{f_a}\)</span> on the largest dataset (ending March 1st, 2018).</p>
<p>The optimal values of the fraction of undetected cases <span class="math notranslate nohighlight">\(\mathbf{f_a}\)</span> are: <code class="docutils literal notranslate"><span class="pre">f_a</span> <span class="pre">=</span> <span class="pre">[0.01,</span> <span class="pre">0.66,</span> <span class="pre">0.89,</span> <span class="pre">0.70]</span></code>. The undetected fraction is thus very small in children aged five years and below, then increases to 89% in individuals aged 15 to 65 years old, and finally decreases to 70% in the senior population. Some (mild) degree of correlation between the infectivity <span class="math notranslate nohighlight">\(\beta\)</span> and the fraction of undetected cases <span class="math notranslate nohighlight">\(\mathbf{f_a}\)</span> is visible. This could be expected, a higher infectivity would logically result in a lower fraction of detected cases to obtain the same fit to the data.</p>
<p><img alt="corner_enddate_2018-03-01" src="_images/corner_enddate_2018-03-01.png" /></p>
<p>Next, we show, for every age group and for our three calibration datasets, the model trajectories plotted on top of the data. Considering how rudimentary this model is, even the predictions made on January 1st, 2018, one month and a half before the peak incidence, are reasonably accurate and can be informative to policymakers and economists. It should be noted that the peak incidence in all age groups falls at least two weeks earlier than was the case in real life, and this is most apparent in the age group <span class="math notranslate nohighlight">\([15,65(\)</span>.</p>
<p>As previously mentioned, this is a rudimentary model and I see two ways of improving its predictive accuracy. First, the model subdivides the population in only four groups depending on their age, this inherently assumes an individual of an age class <span class="math notranslate nohighlight">\(i\)</span> is equally likely to have contact with any other individual in age group <span class="math notranslate nohighlight">\(i\)</span>, even if this person lives on the other side of the country. The model accuracy could be improved significantly by including spatial patches (and potentially human mobility) in the model. As the peak incidence during an epidemic is the superposition of the peaks in different areas, adding spatial heterogeneity will likely broaden and postpone the peak incidence. Additionally, including the protective effects of vaccination could likely further improve this model’s accuracy by lowering the peak incidence in the elderly population, which is more likely to get vaccinated.</p>
<p><strong>Calibration ending on December 15th, 2018</strong></p>
<p><img alt="fit_enddate_2018-01-01" src="_images/fit_enddate_2017-12-15.png" /></p>
<p><strong>Calibration ending on January 1st, 2018</strong></p>
<p><img alt="fit_enddate_2018-02-01" src="_images/fit_enddate_2018-01-01.png" /></p>
<p><strong>Calibration ending on February 1st, 2018</strong></p>
<p><img alt="fit_enddate_2018-03-01" src="_images/fit_enddate_2018-02-01.png" /></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="enzyme_kinetics.html" class="btn btn-neutral float-left" title="A model for the enzymatic esterification of D-glucose and Lauric acid in a continuous-flow reactor" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="references.html" class="btn btn-neutral float-right" title="Additional references" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Tijs Alleman.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>